# ══════════════════════════════════════════════════════════════════════
# REDiTECH Command Center — Environment Configuration
# Copy this file to .env and fill in the values before running
# ══════════════════════════════════════════════════════════════════════

# ── Database ─────────────────────────────────────────────────────────
POSTGRES_USER=rcc
POSTGRES_PASSWORD=          # REQUIRED — generate with: openssl rand -base64 24
POSTGRES_DB=rcc
# DATABASE_URL is constructed automatically in docker-compose.yml
# Override only if connecting to an external database:
# DATABASE_URL=postgresql://user:password@host:5432/dbname

# ── Redis ────────────────────────────────────────────────────────────
REDIS_PASSWORD=             # REQUIRED — generate with: openssl rand -base64 24
# REDIS_URL is set automatically in docker-compose.yml
# Override only if using external Redis:
# REDIS_URL=redis://host:6379

# ── n8n Database (separate user for isolation) ────────────────────────
N8N_DB_USER=n8n
N8N_DB_PASSWORD=            # REQUIRED — generate with: openssl rand -base64 24

# ── Encryption (integration secrets at rest) ──────────────────────────
# Required for encrypting API keys, tokens, and passwords stored in the database.
# Without these, integration credentials are stored in plaintext.
ENCRYPTION_KEY=             # REQUIRED — generate with: openssl rand -base64 32
ENCRYPTION_SALT=            # REQUIRED — generate with: openssl rand -base64 16

# ── NextAuth / Auth.js ───────────────────────────────────────────────
NEXTAUTH_URL=https://your-domain.com
NEXTAUTH_SECRET=generate-a-random-secret-here

# ── Microsoft Entra ID (SSO) ────────────────────────────────────────
# From Azure Portal → Entra ID → App registrations
AZURE_AD_CLIENT_ID=your-client-id
AZURE_AD_CLIENT_SECRET=your-client-secret
AZURE_AD_TENANT_ID=your-tenant-id

# Entra security group Object IDs
ENTRA_GROUP_ADMINS=your-rcc-admins-group-id
ENTRA_GROUP_USERS=your-rcc-users-group-id

# ── Glass-Break Admin ───────────────────────────────────────────────
# Local admin account for emergency access when SSO is unavailable
GLASSBREAK_ADMIN_EMAIL=admin@yourdomain.com
GLASSBREAK_ADMIN_PASSWORD=changeme-to-a-strong-password

# ── n8n Workflow Automation ──────────────────────────────────────────
N8N_WEBHOOK_URL=https://your-domain.com:5678
# n8n instance URL is configured in Settings → Integrations (not here)

# n8n OIDC SSO (Entra ID) — create a separate App Registration for n8n
# Redirect URI: https://<n8n-url>/auth/oidc/callback
OIDC_ISSUER_URL=https://login.microsoftonline.com/{tenant-id}/v2.0
OIDC_CLIENT_ID=
OIDC_CLIENT_SECRET=
OIDC_REDIRECT_URI=https://your-n8n-url/auth/oidc/callback
# Comma-separated email allow-list (leave empty to allow all Entra users)
N8N_OIDC_ALLOWED_EMAILS=

# ── Grafana ──────────────────────────────────────────────────────────
GF_SECURITY_ADMIN_USER=admin
GF_SECURITY_ADMIN_PASSWORD=  # REQUIRED — generate with: openssl rand -base64 24

# ── Grafana 3CX Datasources ─────────────────────────────────────────
# Credentials for the 3CX PostgreSQL databases (provisioned automatically)
GF_DS_REDITECH_DATABASE=reditech3cx_database
GF_DS_REDITECH_USER=tcx_user
GF_DS_REDITECH_PASSWORD=     # REQUIRED
GF_DS_TCC_DATABASE=tcc3cx_database
GF_DS_TCC_USER=tcc_tcx
GF_DS_TCC_PASSWORD=          # REQUIRED

# ── Embedded Service URLs (internal Docker network) ──────────────
# Used by reverse proxy API routes — these are Docker service names
GRAFANA_INTERNAL_URL=http://grafana:3000
