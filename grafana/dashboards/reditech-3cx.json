{
  "uid": "reditech-3cx",
  "title": "REDiTECH 3CX Analytics",
  "description": "3CX call analytics for REDiTECH",
  "tags": [
    "3cx",
    "reditech"
  ],
  "timezone": "browser",
  "schemaVersion": 40,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "refresh": "",
  "time": {
    "from": "now-7d",
    "to": "now"
  },
  "timepicker": {
    "refresh_intervals": [
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h"
    ],
    "time_options": [
      "5m",
      "15m",
      "1h",
      "6h",
      "12h",
      "24h",
      "2d",
      "7d",
      "30d"
    ]
  },
  "templating": {
    "list": [
      {
        "description": "Enter your PostgreSQL cdroutput table path (e.g., public.cdroutput)",
        "hide": 2,
        "label": "PostgreSQL cdroutput table path",
        "name": "db_cdroutput_path",
        "query": "public.cdroutput",
        "skipUrlSync": true,
        "type": "constant",
        "current": {
          "selected": false,
          "text": "public.cdroutput",
          "value": "public.cdroutput"
        },
        "options": [
          {
            "selected": true,
            "text": "public.cdroutput",
            "value": "public.cdroutput"
          }
        ]
      }
    ]
  },
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "panels": [
    {
      "type": "row",
      "title": "Overview",
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 10000,
      "panels": []
    },
    {
      "gridPos": {
        "h": 2,
        "w": 24,
        "x": 0,
        "y": 1
      },
      "id": 1000,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "# 3CX call overview",
        "mode": "markdown"
      },
      "pluginVersion": "12.1.0-89438",
      "type": "text"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "noValue": "0",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 0,
        "y": 3
      },
      "id": 1001,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT\n  COUNT(DISTINCT t.main_call_history_id) AS total_calls\nFROM\n  ${db_cdroutput_path} AS t\nWHERE $__timeFilter(t.cdr_started_at)\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Total number of calls",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "includeByName": {},
            "indexByName": {},
            "renameByName": {
              "total_calls": "Total calls"
            }
          }
        }
      ],
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "noValue": "0",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 3,
        "y": 3
      },
      "id": 1002,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH cdrs AS (\n    SELECT\n        cdr_answered_at,\n        ROW_NUMBER() OVER (PARTITION BY main_call_history_id ORDER BY cdr_id DESC) AS row_num\n    FROM public.cdroutput\n    WHERE cdr_started_at >= to_timestamp(${__from} / 1000)\n      AND cdr_started_at < to_timestamp(${__to} / 1000)\n)\nSELECT COUNT(*) AS answered_calls\nFROM cdrs\nWHERE row_num = 1\nAND cdr_answered_at IS NOT NULL;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Answered Calls",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "includeByName": {},
            "indexByName": {},
            "renameByName": {
              "answered_calls": "Calls answered at the end"
            }
          }
        }
      ],
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "description": "",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 6,
        "y": 3
      },
      "id": 1003,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "text": {
          "percentSize": 1
        },
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH cdrs AS (\n\tSELECT\n\t\tc.cdr_answered_at,\n\t\tROW_NUMBER() OVER (PARTITION BY c.main_call_history_id ORDER BY c.cdr_id DESC) AS row_num\t\t-- 1 = last cdr\n\tFROM ${db_cdroutput_path} AS c\n  WHERE $__timeFilter(c.cdr_started_at)\n)\nSELECT\n\t(COUNT(*) FILTER (WHERE c.cdr_answered_at IS NOT NULL) * 100.0) / NULLIF(COUNT(*), 0) AS percent_answered\nFROM cdrs AS c\nWHERE c.row_num = 1\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "% Answered Calls",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "includeByName": {},
            "indexByName": {},
            "renameByName": {
              "percent_answered": "Calls answered at the end"
            }
          }
        }
      ],
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "red",
                "value": 0
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 9,
        "y": 3
      },
      "id": 1004,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH cdrs AS (\n\tSELECT\n\t\tc.cdr_answered_at,\n\t\tROW_NUMBER() OVER (PARTITION BY c.main_call_history_id ORDER BY c.cdr_id DESC) AS row_num\t\t-- 1 = last cdr\n\tFROM ${db_cdroutput_path} AS c\n  WHERE $__timeFilter(c.cdr_started_at)\n)\nSELECT count(*) AS unanswered_calls\nFROM cdrs AS c\nWHERE c.row_num = 1                 -- 1 = last cdr\nAND c.cdr_answered_at IS NULL\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Not Answered",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "includeByName": {},
            "indexByName": {},
            "renameByName": {
              "unanswered_calls": "Calls not answered at the end"
            }
          }
        }
      ],
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 12,
        "y": 3
      },
      "id": 1005,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    SUM(EXTRACT(EPOCH FROM (t.cdr_ended_at - t.cdr_answered_at))) AS total_talking_duration\nFROM ${db_cdroutput_path} AS t\nWHERE $__timeFilter(t.cdr_started_at);",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Total Talking Duration",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "includeByName": {},
            "indexByName": {},
            "renameByName": {
              "total_talking_time": "Total talking duration"
            }
          }
        }
      ],
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 15,
        "y": 3
      },
      "id": 1006,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    SUM(EXTRACT(EPOCH FROM (t.cdr_ended_at - t.cdr_answered_at))) / NULLIF(COUNT(DISTINCT t.main_call_history_id), 0) AS avg_talking_duration\nFROM ${db_cdroutput_path} AS t\nWHERE $__timeFilter(t.cdr_started_at)\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Average Talking Duration",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "includeByName": {},
            "indexByName": {},
            "renameByName": {
              "avg_talking_duration": "Average talking duration"
            }
          }
        }
      ],
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 18,
        "y": 3
      },
      "id": 1007,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH calls AS (\n  SELECT\n    t.main_call_history_id,\n    EXTRACT(EPOCH FROM (max(t.cdr_ended_at) - min(t.cdr_started_at))) AS duration\n  FROM ${db_cdroutput_path} AS t\n  WHERE $__timeFilter(t.cdr_started_at)\n  GROUP BY t.main_call_history_id\n)\nSELECT\n  avg(c.duration) AS avg_call_duration\nFROM calls AS c\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Average Call Duration",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "includeByName": {},
            "indexByName": {},
            "renameByName": {
              "avg_call_duration": "Average call duration"
            }
          }
        }
      ],
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": 0
              }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 3,
        "x": 21,
        "y": 3
      },
      "id": 1008,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "percentChangeColorMode": "standard",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showPercentChange": false,
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH calls AS (\n  SELECT\n    t.main_call_history_id,\n    EXTRACT(EPOCH FROM (max(t.cdr_ended_at) - min(t.cdr_started_at))) AS duration\n  FROM ${db_cdroutput_path} AS t\n  WHERE $__timeFilter(t.cdr_started_at)\n  GROUP BY t.main_call_history_id\n)\nSELECT\n  max(c.duration) AS longest_call_duration\nFROM calls AS c\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Longest Call Duration",
      "transformations": [
        {
          "id": "organize",
          "options": {
            "excludeByName": {},
            "includeByName": {},
            "indexByName": {},
            "renameByName": {
              "longest_call_duration": "Longest call duration"
            }
          }
        }
      ],
      "type": "stat"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 10
              },
              {
                "color": "#EAB839",
                "value": 50
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 3,
        "x": 0,
        "y": 7
      },
      "id": 1009,
      "options": {
        "minVizHeight": 75,
        "minVizWidth": 75,
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "sizing": "auto"
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH all_calls_count AS (\n    SELECT\n        COUNT(DISTINCT t.main_call_history_id) AS total_count\n    FROM ${db_cdroutput_path} AS t\n    WHERE $__timeFilter(t.cdr_started_at)\n    AND t.destination_entity_type = 'extension'\n),\nmissed_calls_count AS (\n    SELECT\n        COUNT(DISTINCT t.main_call_history_id) AS missed_count\n    FROM ${db_cdroutput_path} AS t\n    WHERE t.cdr_answered_at IS NULL\n    AND $__timeFilter(t.cdr_started_at)\n    AND t.destination_entity_type = 'extension'\n)\nSELECT\n    missed_calls_count.missed_count * 100.0 / NULLIF(all_calls_count.total_count, 0) AS missed_call_rate\nFROM all_calls_count, missed_calls_count\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "% Extension Missed Calls",
      "type": "gauge"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            }
          },
          "mappings": [
            {
              "options": {
                "cancelled": {
                  "index": 3,
                  "text": "Canceled"
                },
                "continued_in": {
                  "index": 2,
                  "text": "Continued further"
                },
                "deflected": {
                  "index": 4,
                  "text": "Deflected"
                },
                "dst_participant_terminated": {
                  "index": 0,
                  "text": "Ended by destination participant"
                },
                "redirected": {
                  "index": 5,
                  "text": "Redirected"
                },
                "rejected": {
                  "index": 6,
                  "text": "Rejected"
                },
                "src_participant_terminated": {
                  "index": 1,
                  "text": "Ended by source participant"
                }
              },
              "type": "value"
            }
          ]
        },
        "overrides": []
      },
      "gridPos": {
        "h": 9,
        "w": 6,
        "x": 3,
        "y": 7
      },
      "id": 1010,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "showLegend": true
        },
        "pieType": "pie",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": true
        },
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        }
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH cdrs AS (\n\tSELECT\n\t\tc.termination_reason,\n\t\tROW_NUMBER() OVER (PARTITION BY c.main_call_history_id ORDER BY c.cdr_id DESC) AS row_num\t\t-- 1 = last cdr\n\tFROM ${db_cdroutput_path} AS c\n  WHERE $__timeFilter(c.cdr_started_at)\n)\nSELECT\n    c.termination_reason,\n    count(*) AS count\nFROM cdrs AS c\nWHERE c.row_num = 1                 -- 1 = last cdr\nAND c.termination_reason IS NOT NULL\nGROUP BY termination_reason\nORDER BY count DESC\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Final Termination Reasons",
      "type": "piechart"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "description": "Time series Graph",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "num_calls"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Number of calls"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 9,
        "w": 15,
        "x": 9,
        "y": 7
      },
      "id": 1011,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 200
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    DATE_TRUNC('hour', t.cdr_started_at) AS \"time\", \n    COUNT(DISTINCT t.main_call_history_id) AS num_calls\nFROM ${db_cdroutput_path} AS t\nWHERE $__timeFilter(t.cdr_started_at)\nGROUP BY 1\nORDER BY 1\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Amount of Calls over Time",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "description": "Top 10 most dialed numbers",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "line+area"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "percentage",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "yellow",
                "value": 60
              },
              {
                "color": "orange",
                "value": 70
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "destination_dn_number"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Dialed number"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "call_count"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Number of calls"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 14,
        "w": 8,
        "x": 0,
        "y": 16
      },
      "id": 1012,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    destination_dn_number, \n    COUNT(*) AS call_count\nFROM ${db_cdroutput_path}\nWHERE $__timeFilter(cdr_started_at)\nGROUP BY destination_dn_number\nORDER BY call_count DESC\nLIMIT 10\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Top 10 Most Dialled Numbers",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "description": "Top 10 answered extensions",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "line+area"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "percentage",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "yellow",
                "value": 60
              },
              {
                "color": "orange",
                "value": 70
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "destination_dn_number"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Extension number"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "call_count"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Number of answered calls"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 14,
        "w": 8,
        "x": 8,
        "y": 16
      },
      "id": 1013,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    destination_dn_number, \n    COUNT(*) AS call_count\nFROM ${db_cdroutput_path}\nWHERE $__timeFilter(cdr_started_at)\nAND destination_entity_type = 'extension'\nAND cdr_answered_at IS NOT NULL\nGROUP BY destination_dn_number\nORDER BY call_count DESC\nLIMIT 10\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Top 10 Answered Extensions",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "grafana-postgresql-datasource",
        "uid": "reditech-3cx-ds"
      },
      "description": "Top 10 extensions with missed calls",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "line+area"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "percentage",
            "steps": [
              {
                "color": "green",
                "value": 0
              },
              {
                "color": "yellow",
                "value": 60
              },
              {
                "color": "orange",
                "value": 70
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "destination_dn_number"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Extension number"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "call_count"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Number of missed calls"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 14,
        "w": 8,
        "x": 16,
        "y": 16
      },
      "id": 1014,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "hideZeros": false,
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "pluginVersion": "12.1.0-89438",
      "targets": [
        {
          "dataset": "cdr",
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n    destination_dn_number, \n    COUNT(*) AS call_count\nFROM ${db_cdroutput_path}\nWHERE $__timeFilter(cdr_started_at)\nAND destination_entity_type = 'extension'\nAND cdr_answered_at IS NULL\nGROUP BY destination_dn_number\nORDER BY call_count DESC\nLIMIT 10\n;",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Top 10 Extensions with Missed Calls",
      "type": "barchart"
    },
    {
      "type": "row",
      "title": "Ring Groups",
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 30
      },
      "id": 10001,
      "panels": [
        {
          "gridPos": {
            "h": 2,
            "w": 24,
            "x": 0,
            "y": 31
          },
          "id": 2016,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# ${ring_group:text}",
            "mode": "markdown"
          },
          "pluginVersion": "12.1.0-89438",
          "type": "text"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 0,
            "y": 33
          },
          "id": 2017,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COUNT(DISTINCT rg.cdr_id) AS total_calls\nFROM ${db_cdroutput_path} AS rg\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls Received",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "total_calls": "Calls received"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 3,
            "y": 33
          },
          "id": 2018,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COUNT(DISTINCT\n    CASE\n      WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN rg.cdr_id\n    END\n  ) AS answered_calls\nFROM ${db_cdroutput_path} AS rg\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "answered_calls": "Calls answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 6,
            "y": 33
          },
          "id": 2019,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "text": {
              "percentSize": 1
            },
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COUNT(DISTINCT\n    CASE\n      WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN rg.cdr_id\n    END\n  ) * 100.0 /\n  NULLIF(COUNT(DISTINCT rg.cdr_id), 0)\n  AS percent_answered\nFROM ${db_cdroutput_path} AS rg\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "% Calls Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "percent_answered": "Calls answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 9,
            "y": 33
          },
          "id": 2020,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COALESCE(COUNT(DISTINCT rg.cdr_id), 0) -\n  COALESCE(COUNT(DISTINCT\n    CASE\n      WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN rg.cdr_id\n    END\n  ), 0)\n  AS unanswered_calls\nFROM ${db_cdroutput_path} AS rg\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls Not Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "unanswered_calls": "Calls not answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 12,
            "y": 33
          },
          "id": 2021,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  SUM(\n    CASE\n      WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN EXTRACT(EPOCH FROM (continued_in_cdr.cdr_ended_at - continued_in_cdr.cdr_answered_at))\n    END\n  ) AS total_talking_time\nFROM ${db_cdroutput_path} AS rg\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Total Talking Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "total_talking_time": "Total talking duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 15,
            "y": 33
          },
          "id": 2022,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  AVG(\n    CASE\n      WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN EXTRACT(EPOCH FROM (continued_in_cdr.cdr_ended_at - continued_in_cdr.cdr_answered_at))\n    END\n  ) AS total_talking_time\nFROM ${db_cdroutput_path} AS rg\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Average Talking Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "total_talking_time": "Average talking duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 18,
            "y": 33
          },
          "id": 2023,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  AVG(\n    CASE\n      WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n        THEN EXTRACT(EPOCH FROM (continued_in_cdr.cdr_ended_at - rg.cdr_started_at))\n      ELSE EXTRACT(EPOCH FROM (rg.cdr_ended_at - rg.cdr_started_at))\n    END\n  ) AS duration\nFROM ${db_cdroutput_path} AS rg\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Average call duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "duration": "Average call duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 21,
            "y": 33
          },
          "id": 2024,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  MAX(\n    CASE\n      WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n        THEN EXTRACT(EPOCH FROM (continued_in_cdr.cdr_ended_at - rg.cdr_started_at))\n      ELSE EXTRACT(EPOCH FROM (rg.cdr_ended_at - rg.cdr_started_at))\n    END\n  ) AS duration\nFROM ${db_cdroutput_path} AS rg\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Longest Call Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "duration": "Longest call duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 10
                  },
                  {
                    "color": "#EAB839",
                    "value": 50
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 3,
            "x": 0,
            "y": 37
          },
          "id": 2025,
          "options": {
            "minVizHeight": 75,
            "minVizWidth": 75,
            "orientation": "auto",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showThresholdLabels": false,
            "showThresholdMarkers": true,
            "sizing": "auto"
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COUNT(DISTINCT\n    CASE\n      WHEN NOT (rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension')\n      THEN rg.cdr_id\n    END\n  ) * 100.0 /\n  NULLIF(COUNT(DISTINCT rg.cdr_id), 0)\n  AS missed_call_rate\nFROM ${db_cdroutput_path} AS rg\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "% Missed Calls",
          "type": "gauge"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "yellow",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 3,
            "x": 3,
            "y": 37
          },
          "id": 2026,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  AVG(EXTRACT(EPOCH FROM (rg.cdr_ended_at - rg.cdr_started_at))) AS duration\nFROM ${db_cdroutput_path} AS rg\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Average Ringing Time",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "duration": "Average ringing time"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                }
              },
              "mappings": [
                {
                  "options": {
                    "cancelled": {
                      "index": 3,
                      "text": "Canceled"
                    },
                    "continued_in": {
                      "index": 2,
                      "text": "Continued further"
                    },
                    "deflected": {
                      "index": 4,
                      "text": "Deflected"
                    },
                    "dst_participant_terminated": {
                      "index": 0,
                      "text": "Ended by ring group user"
                    },
                    "not_answered__cancelled": {
                      "index": 9,
                      "text": "Not answered, canceled"
                    },
                    "not_answered__continued_in": {
                      "index": 8,
                      "text": "Not answered, continued further"
                    },
                    "not_answered__deflected": {
                      "index": 10,
                      "text": "Not answered, deflected"
                    },
                    "not_answered__redirected": {
                      "index": 11,
                      "text": "Not answered, redirected"
                    },
                    "not_answered__rejected": {
                      "index": 12,
                      "text": "Not answered, rejected"
                    },
                    "not_answered__src_participant_terminated": {
                      "index": 7,
                      "text": "Not answered, ended by caller"
                    },
                    "redirected": {
                      "index": 5,
                      "text": "Redirected"
                    },
                    "rejected": {
                      "index": 6,
                      "text": "Rejected"
                    },
                    "src_participant_terminated": {
                      "index": 1,
                      "text": "Ended by caller"
                    }
                  },
                  "type": "value"
                }
              ]
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 6,
            "x": 6,
            "y": 37
          },
          "id": 2027,
          "options": {
            "legend": {
              "displayMode": "table",
              "placement": "right",
              "showLegend": true,
              "values": []
            },
            "pieType": "pie",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n    CASE\n      WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n        THEN COALESCE(continued_in_cdr.termination_reason, 'other')\n      ELSE COALESCE('not_answered__' || rg.termination_reason, 'other')\n    END\n    AS call_outcome,\n    COUNT(*) AS call_count\nFROM ${db_cdroutput_path} AS rg\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\nGROUP BY call_outcome\nORDER BY call_count DESC\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Call Outcomes",
          "type": "piechart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "palette-classic",
                "seriesBy": "last"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "fieldMinMax": false,
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "answered_calls"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "answered calls"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "green",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "total_calls"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "received calls"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "blue",
                      "mode": "fixed"
                    }
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 37
          },
          "id": 2028,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n    DATE_TRUNC('hour', rg.cdr_started_at) AS \"time\",\n    COUNT(DISTINCT rg.cdr_id) AS total_calls,\n    COUNT(DISTINCT\n    CASE\n        WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n        THEN rg.cdr_id\n    END\n    ) AS answered_calls\nFROM ${db_cdroutput_path} AS rg\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\nGROUP BY 1\nORDER BY 1\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Received / Answered Calls over Time",
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "Ring group call statistics",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "extension"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Ring group / Extension"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "calls_received"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Calls received"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "calls_unanswered"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Calls not answered"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "calls_answered"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Calls answered"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "polls_received"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Polls received"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "polls_missed"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Polls missed"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "row_order_no"
                },
                "properties": [
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 43
          },
          "id": 2029,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": false
            },
            "showHeader": true,
            "sortBy": []
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-- Ring group info with last name\nWITH rg_info AS (\n  SELECT\n    rg.destination_dn_number AS dn_number,\n    CASE WHEN '${ring_group:value}' = 'All' THEN 'All ring groups' ELSE COALESCE(rg.destination_dn_name, 'Unknown') END AS name\n  FROM ${db_cdroutput_path} AS rg\n  WHERE rg.cdr_started_at = ( -- Changed this line\n    SELECT\n      MAX(sub_rg.cdr_started_at) -- Changed this to MAX(cdr_started_at)\n    FROM ${db_cdroutput_path} AS sub_rg\n    WHERE $__timeFilter(sub_rg.cdr_started_at)\n      AND ('${ring_group:value}' = 'All' OR sub_rg.destination_dn_number = '${ring_group:value}')\n      AND sub_rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n  )\n),\n-- Ring group totals\nrg_totals AS (\n  SELECT\n    0 AS row_order_no,\n    MAX(rg.destination_dn_number) AS rg_dn,\n    MAX(rg_info.name) AS rg_name,\n    COUNT(DISTINCT rg.cdr_id) AS rg_received_count,\n    COUNT(DISTINCT\n      CASE\n        WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n        THEN rg.cdr_id\n      END\n    ) AS rg_answered_count\n  FROM ${db_cdroutput_path} AS rg\n  INNER JOIN rg_info ON TRUE \n  LEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n    continued_in_cdr.cdr_id = rg.continued_in_cdr_id\n    AND continued_in_cdr.creation_forward_reason = 'polling'\n  WHERE $__timeFilter(rg.cdr_started_at)\n    AND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\n    AND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n  GROUP BY rg.destination_dn_number -- Added GROUP BY for rg_totals\n),\n-- Ring group users statistics\nrg_users_stat AS (\n  SELECT\n    1 AS row_order_no,\n    MAX(rg.destination_dn_number) AS rg_dn,\n    MAX(rg_info.name) AS rg_name,\n    agent_polls.destination_dn_number AS agent_dn,\n    COALESCE(agent_polls.destination_dn_name, 'Unknown') AS agent_name,\n    COUNT(DISTINCT CASE WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND agent_polls.cdr_answered_at IS NOT NULL THEN rg.cdr_id END) AS agent_answered_polls_count,\n    COUNT(agent_polls.cdr_id) AS agent_received_polls_count\n  FROM ${db_cdroutput_path} AS rg\n  INNER JOIN rg_info ON TRUE -- This will cause issues if rg_info returns multiple rows. See note below.\n  INNER JOIN ${db_cdroutput_path} AS agent_polls ON\n    agent_polls.call_history_id = rg.call_history_id\n    AND agent_polls.originating_cdr_id = rg.cdr_id\n    AND agent_polls.destination_dn_type = 'extension'\n    AND agent_polls.creation_method = 'route_to'\n    AND agent_polls.creation_forward_reason = 'polling'\n  WHERE $__timeFilter(rg.cdr_started_at)\n    AND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\n    AND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\n  GROUP BY agent_polls.destination_dn_number, agent_polls.destination_dn_name, rg.destination_dn_number -- Added rg.destination_dn_number to GROUP BY\n)\nSELECT\n  rg.row_order_no,\n  CASE WHEN '${ring_group:value}' != 'All' THEN rg.rg_dn || ' ' ELSE '' END || rg.rg_name || ' [totals]' AS extension,\n  COALESCE(rg.rg_received_count, 0) AS calls_received,\n  COALESCE(rg.rg_received_count, 0) - COALESCE(rg.rg_answered_count, 0) AS calls_unanswered,\n  COALESCE(rg.rg_answered_count, 0) AS calls_answered,\n  CAST(NULL AS bigint) AS polls_received,\n  CAST(NULL AS bigint) AS polls_missed\nFROM rg_totals AS rg\nUNION ALL\nSELECT\n  u.row_order_no,\n  u.agent_dn || ' ' || u.agent_name AS extension,\n  CAST(NULL AS bigint) AS calls_received,\n  CAST(NULL AS bigint) AS calls_unanswered,\n  COALESCE(u.agent_answered_polls_count, 0) AS calls_answered,\n  COALESCE(u.agent_received_polls_count, 0) AS polls_received,\n  COALESCE(u.agent_received_polls_count, 0) - COALESCE(u.agent_answered_polls_count, 0) AS polls_missed\nFROM rg_users_stat AS u\nORDER BY row_order_no, extension;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Ring Group Call Statistics",
          "type": "table"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "Time series Graph",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "num_calls"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "received calls"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 0,
            "y": 51
          },
          "id": 2030,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xField": "time_bucket",
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 200
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n    DATE_TRUNC('hour', rg.cdr_started_at) AS \"time\",\n    COUNT(DISTINCT rg.cdr_id) AS num_calls\nFROM ${db_cdroutput_path} AS rg\nWHERE $__timeFilter(rg.cdr_started_at)\nAND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\nAND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\nGROUP BY 1\nORDER BY 1\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Received Calls over Time",
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "This shows the number of answered calls per extension in the ring group.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "agent_received_calls_count"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "received calls"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "blue",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "agent_received_polls_count"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "received polls"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "#B877D9",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "agent_answered_polls_count"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "answered calls"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "green",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "agent"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Ring group user"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 12,
            "y": 51
          },
          "id": 2031,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  agent_polls.destination_dn_number || ' ' || COALESCE(agent_polls.destination_dn_name, 'Unknown') AS agent,\n  COUNT(DISTINCT agent_polls.main_call_history_id) AS agent_received_calls_count,\n  COUNT(agent_polls.cdr_id) AS agent_received_polls_count,\n  COUNT(DISTINCT CASE WHEN rg.termination_reason IN ('continued_in', 'redirected') AND rg.termination_reason_details = 'polling' AND agent_polls.cdr_answered_at IS NOT NULL THEN rg.cdr_id END) AS agent_answered_polls_count\nFROM ${db_cdroutput_path} AS rg\nINNER JOIN ${db_cdroutput_path} AS agent_polls ON\n  agent_polls.call_history_id = rg.call_history_id\n  AND agent_polls.originating_cdr_id = rg.cdr_id\n  AND agent_polls.destination_dn_type = 'extension'\n  AND agent_polls.creation_method = 'route_to'\n  AND agent_polls.creation_forward_reason = 'polling'\nWHERE $__timeFilter(rg.cdr_started_at)\n  AND ('${ring_group:value}' = 'All' OR rg.destination_dn_number = '${ring_group:value}')\n  AND rg.destination_dn_type IN ('ring_group_ring_all', 'ring_group_hunt')\nGROUP BY agent\nORDER BY agent\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Call Statistics by Ring Group Users",
          "type": "barchart"
        }
      ]
    },
    {
      "type": "row",
      "title": "Queues",
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 32
      },
      "id": 10002,
      "panels": [
        {
          "gridPos": {
            "h": 2,
            "w": 24,
            "x": 0,
            "y": 33
          },
          "id": 3017,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# ${queue:text}",
            "mode": "markdown"
          },
          "pluginVersion": "12.1.0-89438",
          "type": "text"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 0,
            "y": 35
          },
          "id": 3018,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COUNT(DISTINCT q.cdr_id) AS total_calls\nFROM ${db_cdroutput_path} AS q\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls Received",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "total_calls": "Calls received"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 3,
            "y": 35
          },
          "id": 3019,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COUNT(DISTINCT\n    CASE\n      WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN q.cdr_id\n    END\n  ) AS answered_calls\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "answered_calls": "Calls answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 6,
            "y": 35
          },
          "id": 3020,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "text": {
              "percentSize": 1
            },
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COUNT(DISTINCT\n    CASE\n      WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN q.cdr_id\n    END\n  ) * 100.0 /\n  NULLIF(COUNT(DISTINCT q.cdr_id), 0)\n  AS percent_answered\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "% Calls Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "percent_answered": "Calls answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 9,
            "y": 35
          },
          "id": 3021,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COALESCE(COUNT(DISTINCT q.cdr_id), 0) -\n  COALESCE(COUNT(DISTINCT\n    CASE\n      WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN q.cdr_id\n    END\n  ), 0)\n  AS unanswered_calls\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls Not Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "unanswered_calls": "Calls not answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 12,
            "y": 35
          },
          "id": 3022,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  SUM(\n    CASE\n      WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN EXTRACT(EPOCH FROM (continued_in_cdr.cdr_ended_at - continued_in_cdr.cdr_answered_at))\n    END\n  ) AS total_talking_time\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Total Talking Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "total_talking_time": "Total talking duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 15,
            "y": 35
          },
          "id": 3023,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  AVG(\n    CASE\n      WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN EXTRACT(EPOCH FROM (continued_in_cdr.cdr_ended_at - continued_in_cdr.cdr_answered_at))\n    END\n  ) AS total_talking_time\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Average Talking Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "total_talking_time": "Average talking duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 18,
            "y": 35
          },
          "id": 3024,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  AVG(\n    CASE\n      WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n        THEN EXTRACT(EPOCH FROM (continued_in_cdr.cdr_ended_at - q.cdr_started_at))\n      ELSE EXTRACT(EPOCH FROM (q.cdr_ended_at - q.cdr_started_at))\n    END\n  ) AS duration\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Average Call Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "duration": "Average call duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 21,
            "y": 35
          },
          "id": 3025,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  MAX(\n    CASE\n      WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n        THEN EXTRACT(EPOCH FROM (continued_in_cdr.cdr_ended_at - q.cdr_started_at))\n      ELSE EXTRACT(EPOCH FROM (q.cdr_ended_at - q.cdr_started_at))\n    END\n  ) AS duration\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Longest Call Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "duration": "Longest call duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 10
                  },
                  {
                    "color": "#EAB839",
                    "value": 50
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 3,
            "x": 0,
            "y": 39
          },
          "id": 3026,
          "options": {
            "minVizHeight": 75,
            "minVizWidth": 75,
            "orientation": "auto",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showThresholdLabels": false,
            "showThresholdMarkers": true,
            "sizing": "auto"
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COUNT(DISTINCT\n    CASE\n      WHEN NOT (q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension')\n      THEN q.cdr_id\n    END\n  ) * 100.0 /\n  NULLIF(COUNT(DISTINCT q.cdr_id), 0)\n  AS missed_call_rate\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "% Missed Calls",
          "type": "gauge"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "yellow",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 3,
            "x": 3,
            "y": 39
          },
          "id": 3027,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  AVG(EXTRACT(EPOCH FROM (q.cdr_ended_at - q.cdr_started_at))) AS duration\nFROM ${db_cdroutput_path} AS q\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Average Ringing Time",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "duration": "Average ringing time"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                }
              },
              "mappings": [
                {
                  "options": {
                    "cancelled": {
                      "index": 3,
                      "text": "Canceled"
                    },
                    "continued_in": {
                      "index": 2,
                      "text": "Continued further"
                    },
                    "deflected": {
                      "index": 4,
                      "text": "Deflected"
                    },
                    "dst_participant_terminated": {
                      "index": 0,
                      "text": "Ended by queue agent"
                    },
                    "not_answered__cancelled": {
                      "index": 9,
                      "text": "Not answered, canceled"
                    },
                    "not_answered__continued_in": {
                      "index": 8,
                      "text": "Not answered, continued further"
                    },
                    "not_answered__deflected": {
                      "index": 10,
                      "text": "Not answered, deflected"
                    },
                    "not_answered__redirected": {
                      "index": 11,
                      "text": "Not answered, redirected"
                    },
                    "not_answered__rejected": {
                      "index": 12,
                      "text": "Not answered, rejected"
                    },
                    "not_answered__src_participant_terminated": {
                      "index": 7,
                      "text": "Not answered, ended by caller"
                    },
                    "redirected": {
                      "index": 5,
                      "text": "Redirected"
                    },
                    "rejected": {
                      "index": 6,
                      "text": "Rejected"
                    },
                    "src_participant_terminated": {
                      "index": 1,
                      "text": "Ended by caller"
                    }
                  },
                  "type": "value"
                }
              ]
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 6,
            "x": 6,
            "y": 39
          },
          "id": 3028,
          "options": {
            "legend": {
              "displayMode": "table",
              "placement": "right",
              "showLegend": true,
              "values": []
            },
            "pieType": "pie",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n    CASE\n        WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n        THEN COALESCE(continued_in_cdr.termination_reason, 'other')\n        ELSE COALESCE('not_answered__' || q.termination_reason, 'other')\n    END\n    AS call_outcome,\n    COUNT(*) AS call_count\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\nGROUP BY call_outcome\nORDER BY call_count DESC\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Call Outcomes",
          "type": "piechart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "palette-classic",
                "seriesBy": "last"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "fieldMinMax": false,
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "answered_calls"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "answered calls"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "green",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "total_calls"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "received calls"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "blue",
                      "mode": "fixed"
                    }
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 6,
            "w": 12,
            "x": 12,
            "y": 39
          },
          "id": 3029,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n    DATE_TRUNC('hour', q.cdr_started_at) AS \"time\",\n    COUNT(DISTINCT q.cdr_id) AS total_calls,\n    COUNT(DISTINCT\n    CASE\n        WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n        THEN q.cdr_id\n    END\n    ) AS answered_calls\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\nGROUP BY 1\nORDER BY 1\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Received / Answered Calls over Time",
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "orange",
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto",
                  "wrapText": false
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "extension"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Queue / Extension"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "calls_received"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Calls received"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "calls_unanswered"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Calls not answered"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "calls_answered"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Calls answered"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "polls_received"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Polls received"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "polls_missed"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Polls missed"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "row_order_no"
                },
                "properties": [
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 7,
            "w": 24,
            "x": 0,
            "y": 45
          },
          "id": 3030,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": false
            },
            "showHeader": true,
            "sortBy": []
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-- Queue info with last name\nWITH q_info AS (\n  SELECT DISTINCT ON (q.destination_dn_number)\n    q.destination_dn_number AS dn_number,\n    -- The name for 'All' is handled in the final SELECT,\n    -- here we ensure the individual queue name is available.\n    COALESCE(q.destination_dn_name, 'Unknown') AS name\n  FROM ${db_cdroutput_path} AS q\n  WHERE $__timeFilter(q.cdr_started_at)\n    AND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\n    AND q.destination_dn_type = 'queue'\n  ORDER BY q.destination_dn_number, q.cdr_started_at DESC, q.cdr_id DESC\n),\n-- Queue totals\nq_totals AS (\n  SELECT\n    0 AS row_order_no,\n    -- q_dn will be NULL if '${queue:value}' = 'All'\n    MAX(q.destination_dn_number) AS q_dn,\n    -- Use a CASE to set the name based on the variable\n    CASE WHEN '${queue:value}' = 'All' THEN 'All queues' ELSE MAX(q_info.name) END AS q_name,\n    COUNT(DISTINCT q.cdr_id) AS q_received_count,\n    COUNT(DISTINCT\n      CASE\n        WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n        THEN q.cdr_id\n      END\n    ) AS q_answered_count\n  FROM ${db_cdroutput_path} AS q\n  -- IMPORTANT: Join q_info specifically on the dn_number, not ON TRUE\n  INNER JOIN q_info ON q.destination_dn_number = q_info.dn_number\n  LEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n    continued_in_cdr.cdr_id = q.continued_in_cdr_id\n    AND continued_in_cdr.creation_forward_reason = 'polling'\n  WHERE $__timeFilter(q.cdr_started_at)\n    AND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\n    AND q.destination_dn_type = 'queue'\n  GROUP BY\n    -- Conditional GROUP BY: if 'All', group everything into a single NULL group.\n    -- Otherwise, group by individual queue number.\n    CASE\n      WHEN '${queue:value}' = 'All' THEN NULL\n      ELSE q.destination_dn_number\n    END\n),\n-- Queue agents statistics\nq_users_stat AS (\n  SELECT\n    1 AS row_order_no,\n    MAX(q.destination_dn_number) AS q_dn,\n    -- Here, we still want the individual agent's queue name\n    MAX(q_info.name) AS q_name,\n    agent_polls.destination_dn_number AS agent_dn,\n    COALESCE(agent_polls.destination_dn_name, 'Unknown') AS agent_name,\n    COUNT(DISTINCT CASE WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND agent_polls.cdr_answered_at IS NOT NULL THEN q.cdr_id END) AS agent_answered_polls_count,\n    COUNT(agent_polls.cdr_id) AS agent_received_polls_count\n  FROM ${db_cdroutput_path} AS q\n  -- IMPORTANT: Join q_info specifically on the dn_number, not ON TRUE\n  INNER JOIN q_info ON q.destination_dn_number = q_info.dn_number\n  INNER JOIN ${db_cdroutput_path} AS agent_polls ON\n    agent_polls.call_history_id = q.call_history_id\n    AND agent_polls.originating_cdr_id = q.cdr_id\n    AND agent_polls.destination_dn_type = 'extension'\n    AND agent_polls.creation_method = 'route_to'\n    AND agent_polls.creation_forward_reason = 'polling'\n  WHERE $__timeFilter(q.cdr_started_at)\n    AND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\n    AND q.destination_dn_type = 'queue'\n  GROUP BY agent_polls.destination_dn_number, agent_polls.destination_dn_name,\n    -- Group by queue DN when not 'All', otherwise aggregate per agent\n    CASE WHEN '${queue:value}' = 'All' THEN agent_polls.destination_dn_number ELSE q.destination_dn_number END\n)\nSELECT\n  q.row_order_no,\n  -- Simplify the extension formatting now that q_name is conditional\n  q.q_name || ' [totals]' AS extension,\n  COALESCE(q.q_received_count, 0) AS calls_received,\n  COALESCE(q.q_received_count, 0) - COALESCE(q.q_answered_count, 0) AS calls_unanswered,\n  COALESCE(q.q_answered_count, 0) AS calls_answered,\n  CAST(NULL AS bigint) AS polls_received,\n  CAST(NULL AS bigint) AS polls_missed\nFROM q_totals AS q\nUNION ALL\nSELECT\n  u.row_order_no,\n  u.agent_dn || ' ' || u.agent_name AS extension,\n  CAST(NULL AS bigint) AS calls_received,\n  CAST(NULL AS bigint) AS calls_unanswered,\n  COALESCE(u.agent_answered_polls_count, 0) AS calls_answered,\n  COALESCE(u.agent_received_polls_count, 0) AS polls_received,\n  COALESCE(u.agent_received_polls_count, 0) - COALESCE(u.agent_answered_polls_count, 0) AS polls_missed\nFROM q_users_stat AS u\nORDER BY row_order_no, extension;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Queue Call Statistics",
          "type": "table"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "Time series Graph",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "num_calls"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "received calls"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 0,
            "y": 52
          },
          "id": 3031,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xField": "time_bucket",
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 200
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n    DATE_TRUNC('hour', q.cdr_started_at) AS \"time\",\n    COUNT(DISTINCT q.cdr_id) AS num_calls\nFROM ${db_cdroutput_path} AS q\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\nGROUP BY 1\nORDER BY 1\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Received Calls over Time",
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "This shows the number of answered calls per extension in the queue.",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "agent_received_calls_count"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "received calls"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "blue",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "agent_received_polls_count"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "received polls"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "#B877D9",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "agent_answered_polls_count"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "answered calls"
                  },
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "green",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "agent"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Queue agent"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 12,
            "y": 52
          },
          "id": 3032,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  agent_polls.destination_dn_number || ' ' || COALESCE(agent_polls.destination_dn_name, 'Unknown') AS agent,\n  COUNT(DISTINCT agent_polls.main_call_history_id) AS agent_received_calls_count,\n  COUNT(agent_polls.cdr_id) AS agent_received_polls_count,\n  COUNT(DISTINCT CASE WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND agent_polls.cdr_answered_at IS NOT NULL THEN q.cdr_id END) AS agent_answered_polls_count\nFROM ${db_cdroutput_path} AS q\nINNER JOIN ${db_cdroutput_path} AS agent_polls ON\n  agent_polls.call_history_id = q.call_history_id\n  AND agent_polls.originating_cdr_id = q.cdr_id\n  AND agent_polls.destination_dn_type = 'extension'\n  AND agent_polls.creation_method = 'route_to'\n  AND agent_polls.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\n  AND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\n  AND q.destination_dn_type = 'queue'\nGROUP BY agent\nORDER BY agent\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Call Statistics by Queue Agents",
          "type": "barchart"
        }
      ]
    },
    {
      "type": "row",
      "title": "Missed Calls & Callback Efficiency",
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 34
      },
      "id": 10003,
      "panels": [
        {
          "gridPos": {
            "h": 2,
            "w": 24,
            "x": 0,
            "y": 35
          },
          "id": 4018,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# ${queue:text}",
            "mode": "markdown"
          },
          "pluginVersion": "12.1.0-89438",
          "type": "text"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 0,
            "y": 37
          },
          "id": 4019,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COUNT(DISTINCT q.cdr_id) AS total_calls\nFROM ${db_cdroutput_path} AS q\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls Received",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "total_calls": "Calls received"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "yellow",
                    "value": 25
                  },
                  {
                    "color": "orange",
                    "value": 50
                  },
                  {
                    "color": "red",
                    "value": 75
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 3,
            "x": 3,
            "y": 37
          },
          "id": 4020,
          "options": {
            "minVizHeight": 75,
            "minVizWidth": 75,
            "orientation": "auto",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showThresholdLabels": false,
            "showThresholdMarkers": true,
            "sizing": "auto"
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COUNT(DISTINCT\n    CASE\n      WHEN NOT (q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension')\n      THEN q.cdr_id\n    END\n  ) * 100.0 /\n  NULLIF(COUNT(DISTINCT q.cdr_id), 0)\n  AS missed_call_rate\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "% Missed Calls",
          "type": "gauge"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 6,
            "y": 37
          },
          "id": 4021,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT count(*) AS cnt\nFROM ${db_cdroutput_path} AS c\nWHERE $__timeFilter(c.cdr_started_at)\nAND ('${queue:value}' = 'All' OR c.destination_dn_number = '${queue:value}')\nAND c.destination_entity_type = 'queue'\nAND c.termination_reason_details = 'callback_requested'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Callbacks Made",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "cnt": "Callbacks made"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  },
                  {
                    "color": "dark-orange",
                    "value": 25
                  },
                  {
                    "color": "#EAB839",
                    "value": 50
                  },
                  {
                    "color": "green",
                    "value": 75
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 3,
            "x": 9,
            "y": 37
          },
          "id": 4022,
          "options": {
            "minVizHeight": 75,
            "minVizWidth": 75,
            "orientation": "auto",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showThresholdLabels": false,
            "showThresholdMarkers": true,
            "sizing": "auto"
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH cb AS (\n  SELECT\n    CASE WHEN count(*) = 0 THEN 1 ELSE count(*) END AS total_cnt,\n\t\tCOUNT(cb.cdr_id) AS success_cnt\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdroutput_path} AS q ON\n    q.cdr_id = c.continued_in_cdr_id\n    AND q.creation_forward_reason = 'callback_requested'\n    AND q.source_entity_type = 'queue'\n    AND q.destination_dn_number = 'QCB'\n    AND q.termination_reason = 'continued_in'\n  LEFT JOIN ${db_cdroutput_path} AS cb ON\n    cb.cdr_id = q.continued_in_cdr_id\n    AND cb.source_dn_number = 'QCB'\n    --AND cb.cdr_answered_at IS NOT NULL\n    AND cb.continued_in_cdr_id IS NOT NULL\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND ('${queue:value}' = 'All' OR c.destination_dn_number = '${queue:value}')\n  AND c.destination_entity_type = 'queue'\n  AND c.termination_reason = 'continued_in'\n  AND c.termination_reason_details = 'callback_requested'\n)\nSELECT\n\tcb.success_cnt * 100.0 / cb.total_cnt AS successful_callbacks_rate\nFROM cb\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "% Successful Callbacks",
          "type": "gauge"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "thresholds"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "yellow",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 12,
            "y": 37
          },
          "id": 4023,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH cb AS (\n  SELECT\n    EXTRACT(EPOCH FROM (cb.cdr_answered_at - c.cdr_ended_at)) AS response_time\n  FROM ${db_cdroutput_path} AS c\n  INNER JOIN ${db_cdroutput_path} AS q ON\n    q.cdr_id = c.continued_in_cdr_id\n    AND q.creation_forward_reason = 'callback_requested'\n    AND q.source_entity_type = 'queue'\n    AND q.destination_dn_number = 'QCB'\n    AND q.termination_reason = 'continued_in'\n  INNER JOIN ${db_cdroutput_path} AS cb ON\n    cb.cdr_id = q.continued_in_cdr_id\n    AND cb.source_dn_number = 'QCB'\n    AND cb.cdr_answered_at IS NOT NULL\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND ('${queue:value}' = 'All' OR c.destination_dn_number = '${queue:value}')\n  AND c.destination_entity_type = 'queue'\n  AND c.termination_reason = 'continued_in'\n  AND c.termination_reason_details = 'callback_requested'\n)\nSELECT AVG(cb.response_time) AS avg_response_time\nFROM cb\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Average Callback Response Time",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "avg_response_time": "Average callback response time"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 9,
            "x": 15,
            "y": 37
          },
          "id": 4024,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH cb AS (\n  SELECT\n    EXTRACT(EPOCH FROM (cb.cdr_answered_at - c.cdr_ended_at)) AS response_time\n  FROM ${db_cdroutput_path} AS c\n  INNER JOIN ${db_cdroutput_path} AS q ON\n    q.cdr_id = c.continued_in_cdr_id\n    AND q.creation_forward_reason = 'callback_requested'\n    AND q.source_entity_type = 'queue'\n    AND q.destination_dn_number = 'QCB'\n    AND q.termination_reason = 'continued_in'\n  INNER JOIN ${db_cdroutput_path} AS cb ON\n    cb.cdr_id = q.continued_in_cdr_id\n    AND cb.source_dn_number = 'QCB'\n    AND cb.cdr_answered_at IS NOT NULL\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND ('${queue:value}' = 'All' OR c.destination_dn_number = '${queue:value}')\n  AND c.destination_entity_type = 'queue'\n  AND c.termination_reason = 'continued_in'\n  AND c.termination_reason_details = 'callback_requested'\n)\nSELECT\n  0 AS row_order,\n  '< 5 min' AS duration_type,\n  count(CASE WHEN cb.response_time < 300 THEN 1 END) AS calls\nFROM cb\nUNION ALL\nSELECT\n  1 AS row_order,\n  '5-10 min' AS duration_type,\n  count(CASE WHEN cb.response_time BETWEEN 300 AND 599 THEN 1 END) AS calls\nFROM cb\nUNION ALL\nSELECT\n  2 AS row_order,\n  '10-15 min' AS duration_type,\n  count(CASE WHEN cb.response_time BETWEEN 600 AND 899 THEN 1 END) AS calls\nFROM cb\nUNION ALL\nSELECT\n  3 AS row_order,\n  '15-20 min' AS duration_type,\n  count(CASE WHEN cb.response_time BETWEEN 900 AND 1199 THEN 1 END) AS calls\nFROM cb\nUNION ALL\nSELECT\n  4 AS row_order,\n  '20+ min' AS duration_type,\n  count(CASE WHEN cb.response_time >= 1200 THEN 1 END) AS calls\nFROM cb\nORDER BY row_order\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Callback Response Time",
          "transformations": [
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "duration_type",
                    "calls"
                  ]
                }
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls": "Callbacks",
                  "connections": "High value calls",
                  "duration_type": "Response time"
                }
              }
            }
          ],
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 0,
            "y": 41
          },
          "id": 4025,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  COALESCE(COUNT(DISTINCT q.cdr_id), 0) -\n  COALESCE(COUNT(DISTINCT\n    CASE\n      WHEN q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension'\n      THEN q.cdr_id\n    END\n  ), 0)\n  AS unanswered_calls\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls Not Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "unanswered_calls": "Calls not answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "thresholds"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 6,
            "y": 41
          },
          "id": 4026,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH cb AS (\n  SELECT\n    EXTRACT(EPOCH FROM (cb.cdr_answered_at - c.cdr_ended_at)) AS response_time\n  FROM ${db_cdroutput_path} AS c\n  INNER JOIN ${db_cdroutput_path} AS q ON\n    q.cdr_id = c.continued_in_cdr_id\n    AND q.creation_forward_reason = 'callback_requested'\n    AND q.source_entity_type = 'queue'\n    AND q.destination_dn_number = 'QCB'\n    AND q.termination_reason = 'continued_in'\n  INNER JOIN ${db_cdroutput_path} AS cb ON\n    cb.cdr_id = q.continued_in_cdr_id\n    AND cb.source_dn_number = 'QCB'\n    --AND cb.cdr_answered_at IS NOT NULL\n    AND cb.continued_in_cdr_id IS NOT NULL\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND ('${queue:value}' = 'All' OR c.destination_dn_number = '${queue:value}')\n  AND c.destination_entity_type = 'queue'\n  AND c.termination_reason = 'continued_in'\n  AND c.termination_reason_details = 'callback_requested'\n)\nSELECT count(*) AS cnt\nFROM cb\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Successful Callbacks",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "cnt": "Successful callbacks"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "thresholds"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 12,
            "y": 41
          },
          "id": 4027,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH cb AS (\n  SELECT\n    EXTRACT(EPOCH FROM (cb.cdr_answered_at - c.cdr_ended_at)) AS response_time\n  FROM ${db_cdroutput_path} AS c\n  INNER JOIN ${db_cdroutput_path} AS q ON\n    q.cdr_id = c.continued_in_cdr_id\n    AND q.creation_forward_reason = 'callback_requested'\n    AND q.source_entity_type = 'queue'\n    AND q.destination_dn_number = 'QCB'\n    AND q.termination_reason = 'continued_in'\n  INNER JOIN ${db_cdroutput_path} AS cb ON\n    cb.cdr_id = q.continued_in_cdr_id\n    AND cb.source_dn_number = 'QCB'\n    AND cb.cdr_answered_at IS NOT NULL\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND ('${queue:value}' = 'All' OR c.destination_dn_number = '${queue:value}')\n  AND c.destination_entity_type = 'queue'\n  AND c.termination_reason = 'continued_in'\n  AND c.termination_reason_details = 'callback_requested'\n)\nSELECT MAX(cb.response_time) AS max_response_time\nFROM cb\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Max Callback Response Time",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "max_response_time": "Max callback response time"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "fixed"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto",
                  "wrapText": false
                },
                "inspect": false
              },
              "mappings": [
                {
                  "options": {
                    "0": {
                      "color": "#3b3b3b",
                      "index": 0
                    },
                    "1": {
                      "color": "transparent",
                      "index": 1
                    }
                  },
                  "type": "value"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Call ID"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 320
                  },
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "talking_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "bill_cost"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "locale"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Gen Call ID"
                },
                "properties": [
                  {
                    "id": "custom.cellOptions",
                    "value": {
                      "applyToRow": true,
                      "mode": "basic",
                      "type": "color-background",
                      "wrapText": false
                    }
                  },
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "ringing_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 13,
            "w": 10,
            "x": 0,
            "y": 45
          },
          "id": 4028,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": true
            },
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Started at"
              }
            ]
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n\t\tq.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN q.source_entity_type = 'external_line'\n\t\t\t\tTHEN q.source_participant_phone_number || ' ' || coalesce(q.source_dn_name, 'Unknown')\n\t\t\tELSE q.source_dn_number || ' ' || coalesce(q.source_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tcoalesce(q.source_participant_trunk_did, 'Unknown') AS did,\n\t\t--\n\t\tCASE\n\t\t\tWHEN q.destination_entity_type = 'external_line'\n\t\t\t\tTHEN q.destination_participant_phone_number || ' ' || coalesce(q.destination_dn_name, 'Unknown')\n\t\t\tELSE q.destination_dn_number || ' ' || coalesce(q.destination_dn_name, 'Unknown')\n\t\tEND AS queue,\n\t\t--\n    q.cdr_started_at AS started_at,\n\t\tq.cdr_ended_at AS ended_at,\n    EXTRACT(EPOCH FROM (q.cdr_ended_at - q.cdr_started_at)) AS ringing_duration\nFROM ${db_cdroutput_path} AS q\nLEFT JOIN ${db_cdroutput_path} AS continued_in_cdr ON\n  continued_in_cdr.cdr_id = q.continued_in_cdr_id\n  AND continued_in_cdr.creation_forward_reason = 'polling'\nWHERE $__timeFilter(q.cdr_started_at)\nAND ('${queue:value}' = 'All' OR q.destination_dn_number = '${queue:value}')\nAND q.destination_dn_type = 'queue'\nAND NOT (q.termination_reason IN ('continued_in', 'redirected') AND q.termination_reason_details = 'polling' AND continued_in_cdr.cdr_id IS NOT NULL AND continued_in_cdr.cdr_answered_at IS NOT NULL AND continued_in_cdr.destination_entity_type = 'extension')\nORDER BY q.cdr_started_at DESC\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Missed Calls List",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {
                  "did": 3,
                  "ended_at": 5,
                  "main_call_history_id": 1,
                  "queue": 4,
                  "ringing_duration": 6,
                  "source_participant": 2,
                  "started_at": 0
                },
                "renameByName": {
                  "answered_at": "Answered at",
                  "bill_cost": "Bill cost",
                  "cdr_answered_at": "Answered at",
                  "cdr_ended_at": "Ended at",
                  "destination_participant": "Extension",
                  "did": "DID",
                  "duration": "Duration",
                  "ended_at": "Ended at",
                  "gen_call_id": "Gen Call ID",
                  "main_call_history_id": "Call ID",
                  "queue": "Queue",
                  "ringing_duration": "Ringing duration",
                  "source_participant": "Incoming participant",
                  "started_at": "Started at",
                  "talking_duration": "Talking duration"
                }
              }
            },
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "Call ID",
                    "Incoming participant",
                    "DID",
                    "Queue",
                    "Started at",
                    "Ringing duration"
                  ]
                }
              }
            }
          ],
          "type": "table"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "fixed"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto",
                  "wrapText": false
                },
                "inspect": false
              },
              "mappings": [
                {
                  "options": {
                    "0": {
                      "color": "#3b3b3b",
                      "index": 0
                    },
                    "1": {
                      "color": "transparent",
                      "index": 1
                    }
                  },
                  "type": "value"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Call ID"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 320
                  },
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "talking_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "bill_cost"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "locale"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Gen Call ID"
                },
                "properties": [
                  {
                    "id": "custom.cellOptions",
                    "value": {
                      "applyToRow": true,
                      "mode": "basic",
                      "type": "color-background",
                      "wrapText": false
                    }
                  },
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "ringing_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "cb_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Incoming participant"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 158
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 13,
            "w": 14,
            "x": 10,
            "y": 45
          },
          "id": 4029,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": true
            },
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Started at"
              }
            ]
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "SELECT\n  c.main_call_history_id,\n  --\n  CASE\n    WHEN c.source_entity_type = 'external_line'\n      THEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n    ELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n  END AS source_participant,\n  --\n  coalesce(c.source_participant_trunk_did, 'Unknown') AS did,\n  --\n  CASE\n    WHEN c.destination_entity_type = 'external_line'\n      THEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n    ELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n  END AS queue,\n  --\n  c.cdr_started_at AS started_at,\n  --c.cdr_ended_at AS ended_at,\n  EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS ringing_duration,\n  q.cdr_started_at AS cb_started_at,\n  EXTRACT(EPOCH FROM (cb.cdr_ended_at - c.cdr_ended_at)) AS cb_duration,\n  CASE\n    WHEN cb.destination_entity_type = 'external_line'\n      THEN cb.destination_participant_phone_number || ' ' || coalesce(cb.destination_dn_name, 'Unknown')\n    ELSE cb.destination_dn_number || ' ' || coalesce(cb.destination_dn_name, 'Unknown')\n  END AS agent\nFROM ${db_cdroutput_path} AS c\nLEFT JOIN ${db_cdroutput_path} AS q ON\n  q.cdr_id = c.continued_in_cdr_id\n  AND q.creation_forward_reason = 'callback_requested'\n  AND q.source_entity_type = 'queue'\n  AND q.destination_dn_number = 'QCB'\n  AND q.termination_reason = 'continued_in'\nLEFT JOIN ${db_cdroutput_path} AS cb ON\n  cb.cdr_id = q.continued_in_cdr_id\n  AND cb.source_dn_number = 'QCB'\n  --AND cb.cdr_answered_at IS NOT NULL\nWHERE $__timeFilter(c.cdr_started_at)\nAND ('${queue:value}' = 'All' OR c.destination_dn_number = '${queue:value}')\nAND c.destination_entity_type = 'queue'\nAND c.termination_reason = 'continued_in'\nAND c.termination_reason_details = 'callback_requested'\nAND cb.continued_in_cdr_id IS NULL\nORDER BY c.cdr_started_at DESC\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Failed Callbacks",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {
                  "agent": 8,
                  "cb_duration": 7,
                  "cb_started_at": 6,
                  "did": 3,
                  "main_call_history_id": 1,
                  "queue": 4,
                  "ringing_duration": 5,
                  "source_participant": 2,
                  "started_at": 0
                },
                "renameByName": {
                  "agent": "Queue agent",
                  "answered_at": "Answered at",
                  "bill_cost": "Bill cost",
                  "cb_duration": "Callback duration",
                  "cb_started_at": "Callback started at",
                  "cdr_answered_at": "Answered at",
                  "cdr_ended_at": "Ended at",
                  "destination_participant": "Extension",
                  "did": "DID",
                  "duration": "Duration",
                  "ended_at": "Ended at",
                  "gen_call_id": "Gen Call ID",
                  "main_call_history_id": "Call ID",
                  "queue": "Queue",
                  "ringing_duration": "Ringing duration",
                  "source_participant": "Incoming participant",
                  "started_at": "Started at",
                  "talking_duration": "Talking duration"
                }
              }
            },
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "Call ID",
                    "Incoming participant",
                    "DID",
                    "Queue",
                    "Started at",
                    "Ringing duration",
                    "Callback started at",
                    "Callback duration",
                    "Queue agent"
                  ]
                }
              }
            }
          ],
          "type": "table"
        }
      ]
    },
    {
      "type": "row",
      "title": "Extension Statistics",
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 36
      },
      "id": 10004,
      "panels": [
        {
          "gridPos": {
            "h": 2,
            "w": 24,
            "x": 0,
            "y": 37
          },
          "id": 5019,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# Extension Statistics Dashboard",
            "mode": "markdown"
          },
          "pluginVersion": "12.1.0-89438",
          "type": "text"
        },
        {
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 39
          },
          "id": 5020,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "",
            "mode": "markdown"
          },
          "pluginVersion": "12.1.0-89438",
          "title": "TOTALS",
          "type": "text"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 0,
            "y": 40
          },
          "id": 5021,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "count"
              ],
              "fields": "/^extension$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A"
            }
          ],
          "title": "Extension Count",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 3,
            "y": 40
          },
          "id": 5022,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^inbound_answered$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A",
              "withTransforms": false
            }
          ],
          "title": "In [Answered]",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 6,
            "y": 40
          },
          "id": 5023,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^inbound_unanswered$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A",
              "withTransforms": false
            }
          ],
          "title": "In [Not Answered]",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 9,
            "y": 40
          },
          "id": 5024,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^outbound_answered$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A",
              "withTransforms": false
            }
          ],
          "title": "Out [Answered]",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 12,
            "y": 40
          },
          "id": 5025,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^outbound_unanswered$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A",
              "withTransforms": false
            }
          ],
          "title": "Out [Not Answered]",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 15,
            "y": 40
          },
          "id": 5026,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^total_answered$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A",
              "withTransforms": false
            }
          ],
          "title": "Total [Answered]",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 18,
            "y": 40
          },
          "id": 5027,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^total_unanswered$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A",
              "withTransforms": false
            }
          ],
          "title": "Total [Not Answered]",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 21,
            "y": 40
          },
          "id": 5028,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^total_talking_sec$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A",
              "withTransforms": false
            }
          ],
          "title": "Talking Time",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "total_talking_sec"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 22,
            "w": 24,
            "x": 0,
            "y": 44
          },
          "id": 5029,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": true
            },
            "showHeader": true,
            "sortBy": []
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "WITH cdrs AS (\n  SELECT\n    c.*\n  FROM ${db_cdroutput_path} AS c\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND c.creation_method NOT IN ('barge_in', 'barge_in_listen', 'barge_in_whisper')\t-- Exclude bargein calls\n  AND NOT (c.creation_forward_reason = 'polling' AND c.cdr_answered_at IS NULL)\t\t  -- Exclude polling\n  AND NOT (c.source_entity_type = 'ivr' AND c.source_dn_number = 'MakeCall')\t\t\t  -- Don't calc MakeCall calls\n  AND c.destination_entity_type NOT IN ('endcall', 'unknown')\t\t\t\t\t\t\t          -- Don't calc EndCall/Unknown calls\n  AND c.source_entity_type NOT IN ('endcall', 'unknown')\t\t\t\t\t\t\t\t            -- Don't calc EndCall/Unknown calls\n),\nmember_participants AS (\n  SELECT\n    c.dn,\n    c.participant_id,\n    MAX(c.dn_name) AS dn_name,\n    BOOL_OR(c.is_incoming) AS is_incoming -- Changed for PostgreSQL (assuming is_incoming is boolean)\n  FROM (\n    SELECT\n      c.source_dn_number AS dn,\n      c.source_dn_name AS dn_name,\n      c.source_participant_id AS participant_id,\n      c.source_participant_is_incoming AS is_incoming\n    FROM cdrs AS c\n    WHERE source_entity_type = 'extension'\n    UNION ALL\n    SELECT\n      c.destination_dn_number AS dn,\n      c.destination_dn_name AS dn_name,\n      c.destination_participant_id AS participant_id,\n      c.destination_participant_is_incoming AS is_incoming\n    FROM cdrs AS c\n    WHERE destination_entity_type = 'extension'\n  ) AS c\n  GROUP BY c.dn, c.participant_id\n),\noutgoing_calls_all AS (\n\tSELECT\n\t\tmp.*,\n\t\tc.destination_entity_type,\n\t\tCOALESCE(a1.is_answered, a2.is_answered, FALSE) AS is_answered\n\tFROM member_participants AS mp\n\tINNER JOIN cdrs AS c ON\n\t\tc.source_participant_id = mp.participant_id\n\t\tAND c.creation_method = 'call_init'\n\tLEFT JOIN (\n\t\tSELECT\n\t\t\tcdrs.source_participant_id AS participant_id,\n\t\t\tCASE WHEN max(cdrs.cdr_answered_at) IS NOT NULL THEN TRUE ELSE FALSE END AS is_answered\n\t\tFROM cdrs\n\t\tWHERE cdrs.cdr_answered_at IS NOT NULL\n\t\tAND cdrs.destination_entity_type NOT IN ('ring_group_ring_all', 'ring_group_hunt', 'queue')\n\t\tGROUP BY cdrs.source_participant_id\n\t) AS a1 ON\n\t\ta1.participant_id = mp.participant_id\n\tLEFT JOIN (\n\t\tSELECT\n\t\t\tcdrs.destination_participant_id AS participant_id,\n\t\t\tCASE WHEN max(cdrs.cdr_answered_at) IS NOT NULL THEN TRUE ELSE FALSE END AS is_answered\n\t\tFROM cdrs\n\t\tWHERE cdrs.cdr_answered_at IS NOT NULL\n\t\tAND cdrs.source_entity_type NOT IN ('ring_group_ring_all', 'ring_group_hunt', 'queue')\n\t\tGROUP BY cdrs.destination_participant_id\n\t) AS a2 ON\n\t\ta2.participant_id = mp.participant_id\n),\noutgoing_calls AS (\n  SELECT\n    oc.dn,\n    MAX(oc.dn_name) AS dn_name,\n    COUNT(oc.dn) FILTER (WHERE oc.is_answered) AS answered_calls_count, -- Changed COUNTIF\n    COUNT(oc.dn) FILTER (WHERE NOT oc.is_answered) AS unanswered_calls_count -- Changed COUNTIF\n  FROM outgoing_calls_all AS oc\n  GROUP BY oc.dn\n),\nincoming_calls AS (\n\tSELECT\n\t\tic.dn,\n    MAX(ic.dn_name) AS dn_name,\n\t\tSUM(CASE WHEN ic.is_answered THEN 1 ELSE 0 END) AS answered_calls_count,\n\t\tSUM(CASE WHEN NOT ic.is_answered THEN 1 ELSE 0 END) AS unanswered_calls_count\n\tFROM (\n\t\tSELECT\n\t\t\tmp.*,\n\t\t\tCOALESCE(a1.is_answered, a2.is_answered, FALSE) AS is_answered\n\t\tFROM member_participants AS mp\n\t\tLEFT JOIN outgoing_calls_all AS oc ON\n\t\t\toc.participant_id = mp.participant_id\n\t\tLEFT JOIN (\n\t\t\tSELECT\n\t\t\t\tcdrs.source_participant_id AS participant_id,\n\t\t\t\tCASE WHEN max(cdrs.cdr_answered_at) IS NOT NULL THEN TRUE ELSE FALSE END AS is_answered\n\t\t\tFROM cdrs\n\t\t\tWHERE cdrs.cdr_answered_at IS NOT NULL\n\t\t\tGROUP BY cdrs.source_participant_id\n\t\t) AS a1 ON\n\t\t\ta1.participant_id = mp.participant_id\n\t\tLEFT JOIN (\n\t\t\tSELECT\n\t\t\t\tcdrs.destination_participant_id AS participant_id,\n\t\t\t\tCASE WHEN max(cdrs.cdr_answered_at) IS NOT NULL THEN TRUE ELSE FALSE END AS is_answered\n\t\t\tFROM cdrs\n\t\t\tWHERE cdrs.cdr_answered_at IS NOT NULL\n\t\t\tGROUP BY cdrs.destination_participant_id\n\t\t) AS a2 ON\n\t\t\ta2.participant_id = mp.participant_id\n\t\tWHERE oc.participant_id IS NULL\n\t) AS ic\n\tGROUP BY ic.dn\n),\ntalking_times AS (\n  SELECT\n    c.dn,\n    SUM(c.talking_dur_sec) AS talking_dur_sec\n  FROM (\n    SELECT \n      c.source_dn_number AS dn,\n      EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) AS talking_dur_sec -- Changed TIMESTAMP_DIFF\n    FROM cdrs AS c\n    WHERE c.cdr_answered_at IS NOT NULL AND c.source_entity_type = 'extension'\n    \n    UNION ALL\n    \n    SELECT \n      c.destination_dn_number AS dn,\n      EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) AS talking_dur_sec -- Changed TIMESTAMP_DIFF\n    FROM cdrs AS c\n    WHERE c.cdr_answered_at IS NOT NULL AND c.destination_entity_type = 'extension'\n  ) AS c\n  GROUP BY c.dn\n)\nSELECT\n  MAX(COALESCE(oc.dn, ic.dn) || ' ' || COALESCE(oc.dn_name, ic.dn_name)) AS extension,\n  COALESCE(MAX(ic.answered_calls_count), 0) AS inbound_answered,\n  COALESCE(MAX(ic.unanswered_calls_count), 0) AS inbound_unanswered,\n  COALESCE(MAX(oc.answered_calls_count), 0) AS outbound_answered,\n  COALESCE(MAX(oc.unanswered_calls_count), 0) AS outbound_unanswered,\n  COALESCE(MAX(ic.answered_calls_count), 0) + COALESCE(MAX(oc.answered_calls_count), 0) AS total_answered,\n  COALESCE(MAX(ic.unanswered_calls_count), 0) + COALESCE(MAX(oc.unanswered_calls_count), 0) AS total_unanswered,\n  COALESCE(MAX(t.talking_dur_sec), 0) AS total_talking_sec\nFROM outgoing_calls AS oc\nFULL JOIN incoming_calls AS ic ON\n  ic.dn = oc.dn\nLEFT JOIN talking_times AS t ON\n  COALESCE(oc.dn, ic.dn) = t.dn\nGROUP BY COALESCE(oc.dn, ic.dn)\nORDER BY extension;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Extension Statistics",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "display_name": "Extension Name",
                  "extension": "Extension",
                  "inbound_answered": "In [answered]",
                  "inbound_unanswered": "In [not answered]",
                  "outbound_answered": "Out [answered]",
                  "outbound_unanswered": "Out [not answered]",
                  "total_answered": "Total [answered]",
                  "total_talking_sec": "Talking time",
                  "total_unanswered": "Total [not answered]"
                }
              }
            }
          ],
          "type": "table"
        }
      ]
    },
    {
      "type": "row",
      "title": "Inbound Calls",
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 38
      },
      "id": 10005,
      "panels": [
        {
          "gridPos": {
            "h": 2,
            "w": 24,
            "x": 0,
            "y": 39
          },
          "id": 6020,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# Inbound Calls",
            "mode": "markdown"
          },
          "pluginVersion": "12.1.0-89438",
          "type": "text"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 0,
            "y": 41
          },
          "id": 6021,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Calls received$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-------------------------------\n-- Inbound answered connections\n-------------------------------\nWITH inbound_connections AS (\n\t---------\n\t-- Source\n\t---------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at AS answered_at,\n\t\tc.cdr_ended_at AS ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tEXTRACT(EPOCH FROM (coalesce(c.cdr_answered_at, c.cdr_ended_at) - c.cdr_started_at)) AS ringing_duration,\n\t\tCASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tLEFT JOIN ${db_cdroutput_path} AS c_orig ON\n\t\tc_orig.cdr_id = c.originating_cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND\n\t(\n\t\t(\t\n\t\t\tc.source_entity_type = 'external_line' \n\t\t\tAND c.destination_entity_type = 'inbound_routing'\n\t\t\tAND c.source_participant_is_incoming = TRUE\n\t\t\tAND c.termination_reason != 'continued_in'\n\t\t)\n\t\tOR\n\t\t(\t\n\t\t\tc.source_entity_type = 'external_line' \n\t\t\tAND c.destination_entity_type NOT IN ('inbound_routing', 'outbound_rule') \n\t\t\tAND c.source_participant_is_incoming = TRUE\n\t\t)\n\t)\n\tAND NOT (c.creation_forward_reason = 'polling' AND c.cdr_answered_at IS NULL AND c_orig.destination_entity_type IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue'))\t\t-- Exclude polling\n\t--AND c.cdr_answered_at IS NOT NULL\n\tUNION ALL\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at AS answered_at,\n\t\tc.cdr_ended_at AS ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tEXTRACT(EPOCH FROM (coalesce(c.cdr_answered_at, c.cdr_ended_at) - c.cdr_started_at)) AS ringing_duration,\n\t\tcoalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0) AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.destination_entity_type = 'external_line'\n\tAND c.destination_participant_is_incoming\n\t--AND c.cdr_answered_at IS NOT NULL\n)\nSELECT\n\tCOUNT(DISTINCT c.main_call_history_id) AS calls_received,\n\tCOUNT(DISTINCT CASE WHEN c.talking_duration > 0 THEN c.main_call_history_id END) AS calls_answered,\n\tCOUNT(DISTINCT CASE WHEN c.talking_duration > 0 THEN c.main_call_history_id END) * 100.0 / \n\t\tCASE WHEN COUNT(DISTINCT c.main_call_history_id) = 0 THEN 1 ELSE COUNT(DISTINCT c.main_call_history_id) END AS calls_answered_percent,\n\tCOUNT(DISTINCT c.main_call_history_id) - COUNT(DISTINCT CASE WHEN c.talking_duration > 0 THEN c.main_call_history_id END) AS calls_unanswered,\n\tSUM(c.talking_duration) AS talking_duration,\n\tSUM(c.talking_duration) / CASE WHEN COUNT(DISTINCT c.main_call_history_id) = 0 THEN 1 ELSE COUNT(DISTINCT c.main_call_history_id) END AS avg_talking_duration,\n\tSUM(c.duration) / CASE WHEN COUNT(DISTINCT c.main_call_history_id) = 0 THEN 1 ELSE COUNT(DISTINCT c.main_call_history_id) END AS avg_duration,\n\tSUM(c.duration) AS duration\nFROM inbound_connections AS c\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls Received",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls_answered": "",
                  "calls_received": "Calls received"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 3,
            "y": 41
          },
          "id": 6022,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Calls answered$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 3,
              "refId": "A"
            }
          ],
          "title": "Answered Calls",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls_answered": "Calls answered",
                  "calls_received": ""
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 6,
            "y": 41
          },
          "id": 6023,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^% answered$/",
              "values": false
            },
            "showPercentChange": false,
            "text": {
              "percentSize": 1
            },
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 3,
              "refId": "A"
            }
          ],
          "title": "% Calls Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls_answered": "",
                  "calls_answered_percent": "% answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 9,
            "y": 41
          },
          "id": 6024,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Calls not answered$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 3,
              "refId": "A"
            }
          ],
          "title": "Calls Not Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls_unanswered": "Calls not answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 12,
            "y": 41
          },
          "id": 6025,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Average talking duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 3,
              "refId": "A"
            }
          ],
          "title": "Average Talking Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "avg_talking_duration": "Average talking duration",
                  "talking_duration": ""
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 15,
            "y": 41
          },
          "id": 6026,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Talking duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 3,
              "refId": "A"
            }
          ],
          "title": "Total Talking Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls_unanswered": "",
                  "talking_duration": "Talking duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 18,
            "y": 41
          },
          "id": 6027,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Average call duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 3,
              "refId": "A"
            }
          ],
          "title": "Average Call Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "avg_duration": "Average call duration",
                  "avg_talking_duration": ""
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 21,
            "y": 41
          },
          "id": 6028,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Total call duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 3,
              "refId": "A"
            }
          ],
          "title": "Total Call Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "avg_duration": "",
                  "avg_talking_duration": "",
                  "duration": "Total call duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                }
              },
              "mappings": []
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 4,
            "x": 0,
            "y": 45
          },
          "id": 6029,
          "options": {
            "displayLabels": [
              "value",
              "name",
              "percent"
            ],
            "legend": {
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true,
              "values": [
                "percent",
                "value"
              ]
            },
            "pieType": "pie",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-------------------------------\n-- Inbound answered connections\n-------------------------------\nWITH inbound_connections AS (\n\t---------\n\t-- Source\n\t---------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\tcoalesce(c.source_participant_trunk_did, 'Unknown') AS did\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdroutput_path} AS c_orig ON\n\t\tc_orig.cdr_id = c.originating_cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND\n\t(\n\t\t(\t\n\t\t\tc.source_entity_type = 'external_line' \n\t\t\tAND c.destination_entity_type = 'inbound_routing'\n\t\t\tAND c.source_participant_is_incoming = TRUE\n\t\t\tAND c.termination_reason != 'continued_in'\n\t\t)\n\t\tOR\n\t\t(\t\n\t\t\tc.source_entity_type = 'external_line' \n\t\t\tAND c.destination_entity_type NOT IN ('inbound_routing', 'outbound_rule') \n\t\t\tAND c.source_participant_is_incoming = TRUE\n\t\t)\n\t)\n\tAND NOT (c.creation_forward_reason = 'polling' AND c.cdr_answered_at IS NULL AND c_orig.destination_entity_type IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue'))\t\t-- Exclude polling\n\t--AND c.cdr_answered_at IS NOT NULL\n\tUNION ALL\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\tcoalesce(c.destination_participant_trunk_did, 'Unknown') AS did\n\tFROM ${db_cdroutput_path} AS c\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.destination_entity_type = 'external_line'\n\tAND c.destination_participant_is_incoming\n\t--AND c.cdr_answered_at IS NOT NULL\n)\nSELECT\n\tc.did,\n\tcount(DISTINCT c.main_call_history_id) AS calls\nFROM inbound_connections AS c\nGROUP BY c.did\nORDER BY calls DESC\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls By DID",
          "type": "piechart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "smooth",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 10,
            "x": 4,
            "y": 45
          },
          "id": 6030,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "----------------------\n-- Inbound connections\n----------------------\nWITH inbound_connections AS (\n\t---------\n\t-- Source\n\t---------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\tc.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdroutput_path} AS c_orig ON\n\t\tc_orig.cdr_id = c.originating_cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND\n\t(\n\t\t(\t\n\t\t\tc.source_entity_type = 'external_line' \n\t\t\tAND c.destination_entity_type = 'inbound_routing'\n\t\t\tAND c.source_participant_is_incoming = TRUE\n\t\t\tAND c.termination_reason != 'continued_in'\n\t\t)\n\t\tOR\n\t\t(\t\n\t\t\tc.source_entity_type = 'external_line' \n\t\t\tAND c.destination_entity_type NOT IN ('inbound_routing', 'outbound_rule') \n\t\t\tAND c.source_participant_is_incoming = TRUE\n\t\t)\n\t)\n\tAND NOT (c.creation_forward_reason = 'polling' AND c.cdr_answered_at IS NULL AND c_orig.destination_entity_type IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue'))\t\t-- Exclude polling\n\t--AND c.cdr_answered_at IS NOT NULL\n\tGROUP BY c.main_call_history_id, participant_id\n\tUNION ALL\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\tc.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.destination_entity_type = 'external_line'\n\tAND c.destination_participant_is_incoming\n\t--AND c.cdr_answered_at IS NOT NULL\n\tGROUP BY c.main_call_history_id, participant_id\n)\nSELECT\n\tdate_trunc('hour', i.started_at) AS time_bucket,\n\tCOUNT(DISTINCT i.participant_id) AS calls\nFROM inbound_connections AS i\nGROUP BY time_bucket\nORDER BY time_bucket\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Inbound Calls over Time",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls": "Calls",
                  "time_bucket": "Time"
                }
              }
            }
          ],
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 10,
            "x": 14,
            "y": 45
          },
          "id": 6031,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "----------------------\n-- Inbound connections\n----------------------\nWITH inbound_connections AS (\n\t---------\n\t-- Source\n\t---------\n\tSELECT\n\t\t--c.main_call_history_id,\n    c.destination_participant_id AS extension_participant_id,\n\t\tmax(CASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND) AS extension\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdroutput_path} AS c_orig ON\n\t\tc_orig.cdr_id = c.originating_cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND\n\t(\n\t\t(\t\n\t\t\tc.source_entity_type = 'external_line' \n\t\t\tAND c.destination_entity_type = 'inbound_routing'\n\t\t\tAND c.source_participant_is_incoming = TRUE\n\t\t\tAND c.termination_reason != 'continued_in'\n\t\t)\n\t\tOR\n\t\t(\t\n\t\t\tc.source_entity_type = 'external_line' \n\t\t\tAND c.destination_entity_type NOT IN ('inbound_routing', 'outbound_rule') \n\t\t\tAND c.source_participant_is_incoming = TRUE\n\t\t)\n\t)\n\tAND NOT (c.creation_forward_reason = 'polling' AND c.cdr_answered_at IS NULL AND c_orig.destination_entity_type IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue'))\t\t-- Exclude polling\n\t--AND c.cdr_answered_at IS NOT NULL\n  GROUP BY extension_participant_id\n\tUNION ALL\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\t--c.main_call_history_id,\n    c.source_participant_id AS extension_participant_id,\n\t\tmax(CASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND) AS extension\n\tFROM ${db_cdroutput_path} AS c\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.destination_entity_type = 'external_line'\n\tAND c.destination_participant_is_incoming\n\t--AND c.cdr_answered_at IS NOT NULL\n\tGROUP BY extension_participant_id\n)\nSELECT\n\ti.extension,\n\tcount(DISTINCT i.extension_participant_id) AS calls\nFROM inbound_connections AS i\nGROUP BY extension\nORDER BY calls DESC\nLIMIT 10\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Top Called Extensions",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls": "Calls",
                  "extension": "Extension"
                }
              }
            }
          ],
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "fixed"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto",
                  "wrapText": false
                },
                "inspect": false
              },
              "mappings": [
                {
                  "options": {
                    "0": {
                      "color": "#3b3b3b",
                      "index": 0
                    },
                    "1": {
                      "color": "transparent",
                      "index": 1
                    }
                  },
                  "type": "value"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Call ID"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 320
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "talking_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "bill_cost"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "locale"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Gen Call ID"
                },
                "properties": [
                  {
                    "id": "custom.cellOptions",
                    "value": {
                      "applyToRow": true,
                      "mode": "basic",
                      "type": "color-background",
                      "wrapText": false
                    }
                  },
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "ringing_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 14,
            "w": 24,
            "x": 0,
            "y": 54
          },
          "id": 6032,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "enablePagination": true,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": false
            },
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Started at"
              }
            ]
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "----------------------\n-- Inbound connections\n----------------------\nWITH inbound_connections AS (\n\t---------\n\t-- Source\n\t---------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tcoalesce(c.source_participant_trunk_did, 'Unknown') AS did,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at AS answered_at,\n\t\tc.cdr_ended_at AS ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tEXTRACT(EPOCH FROM (coalesce(c.cdr_answered_at, c.cdr_ended_at) - c.cdr_started_at)) AS ringing_duration,\n\t\tCASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tLEFT JOIN ${db_cdroutput_path} AS c_orig ON\n\t\tc_orig.cdr_id = c.originating_cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND\n\t(\n\t\t(\t\n\t\t\tc.source_entity_type = 'external_line' \n\t\t\tAND c.destination_entity_type = 'inbound_routing'\n\t\t\tAND c.source_participant_is_incoming = TRUE\n\t\t\tAND c.termination_reason != 'continued_in'\n\t\t)\n\t\tOR\n\t\t(\t\n\t\t\tc.source_entity_type = 'external_line' \n\t\t\tAND c.destination_entity_type NOT IN ('inbound_routing', 'outbound_rule') \n\t\t\tAND c.source_participant_is_incoming = TRUE\n\t\t)\n\t)\n\tAND NOT (c.creation_forward_reason = 'polling' AND c.cdr_answered_at IS NULL AND c_orig.destination_entity_type IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue'))\t\t-- Exclude polling\n\t--AND c.cdr_answered_at IS NOT NULL\n\tUNION ALL\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tcoalesce(c.destination_participant_trunk_did, 'Unknown') AS did,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at AS answered_at,\n\t\tc.cdr_ended_at AS ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tEXTRACT(EPOCH FROM (coalesce(c.cdr_answered_at, c.cdr_ended_at) - c.cdr_started_at)) AS ringing_duration,\n\t\tcoalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0) AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.destination_entity_type = 'external_line'\n\tAND c.destination_participant_is_incoming\n\t--AND c.cdr_answered_at IS NOT NULL\n),\nstat AS (\n\tSELECT\n\t\tROW_NUMBER() OVER(ORDER BY c.started_at DESC) AS id1,\n\t\tCASE WHEN (ROW_NUMBER() OVER(PARTITION BY c.main_call_history_id ORDER BY c.started_at DESC) - 1) > 0 THEN 1 ELSE 0 END AS id2,\n\t\t*\n\tFROM inbound_connections AS c\n)\nSELECT\n\t(c.id1 - SUM(c.id2) OVER(ORDER BY c.started_at DESC)) % 2 AS gen_call_id,\n\t-- c.main_call_history_id,\n\tc.source_participant,\n\tc.did,\n\tc.destination_participant,\n\tc.started_at,\n\tc.answered_at,\n\tc.ended_at,\n\tc.duration,\n\tc.ringing_duration,\n\tc.talking_duration,\n\tc.bill_cost\nFROM stat AS c\nORDER BY c.started_at DESC;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Inbound Calls List",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "answered_at": "Answered at",
                  "bill_cost": "Bill cost",
                  "cdr_answered_at": "Answered at",
                  "cdr_ended_at": "Ended at",
                  "destination_participant": "Extension",
                  "did": "DID",
                  "duration": "Duration",
                  "ended_at": "Ended at",
                  "gen_call_id": "Gen Call ID",
                  "main_call_history_id": "Call ID",
                  "ringing_duration": "Ringing duration",
                  "source_participant": "External participant",
                  "started_at": "Started at",
                  "talking_duration": "Talking duration"
                }
              }
            },
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "Gen Call ID",
                    "Call ID",
                    "External participant",
                    "Extension",
                    "Started at",
                    "Answered at",
                    "Ended at",
                    "Ringing duration",
                    "Talking duration",
                    "Bill cost",
                    "DID"
                  ]
                }
              }
            }
          ],
          "type": "table"
        }
      ]
    },
    {
      "type": "row",
      "title": "Outbound Calls",
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 40
      },
      "id": 10006,
      "panels": [
        {
          "gridPos": {
            "h": 2,
            "w": 24,
            "x": 0,
            "y": 41
          },
          "id": 7021,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# Outbound Calls",
            "mode": "markdown"
          },
          "pluginVersion": "12.1.0-89438",
          "type": "text"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 0,
            "y": 43
          },
          "id": 7022,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Calls received$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-----------------------\n-- Outbound connections\n-----------------------\nWITH outbound_connections AS (\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at AS answered_at,\n\t\tc.cdr_ended_at AS ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tEXTRACT(EPOCH FROM (coalesce(c.cdr_answered_at, c.cdr_ended_at) - c.cdr_started_at)) AS ringing_duration,\n\t\tCASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tLEFT JOIN ${db_cdroutput_path} AS c_orig ON\n\t\tc_orig.cdr_id = c.originating_cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND \n\t(\n\t\t(c.destination_entity_type = 'outbound_rule' AND c.destination_participant_is_incoming = FALSE AND c.termination_reason NOT IN ('cancelled', 'continued_in', 'rejected', 'src_participant_terminated', 'dst_participant_terminated'))\n\t\tOR\n\t\t(c.destination_entity_type = 'external_line' AND c.destination_participant_is_incoming = FALSE)\n\t)\n\tAND NOT (c.creation_forward_reason = 'polling' AND c.cdr_answered_at IS NULL AND c_orig.destination_entity_type IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue'))\t\t-- Exclude polling\n\t--AND c.cdr_answered_at IS NOT NULL\n\tUNION ALL\n\t--------------\n\t-- Source\n\t--------------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at AS answered_at,\n\t\tc.cdr_ended_at AS ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tEXTRACT(EPOCH FROM (coalesce(c.cdr_answered_at, c.cdr_ended_at) - c.cdr_started_at)) AS ringing_duration,\n\t\tcoalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0) AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.source_entity_type = 'external_line'\n\tAND c.source_participant_is_incoming = FALSE\n\t--AND c.cdr_answered_at IS NOT NULL\n)\nSELECT\n\tCOUNT(DISTINCT c.main_call_history_id) AS calls_received,\n\tCOUNT(DISTINCT CASE WHEN c.talking_duration > 0 THEN c.main_call_history_id END) AS calls_answered,\n\tCOUNT(DISTINCT CASE WHEN c.talking_duration > 0 THEN c.main_call_history_id END) * 100.0 / \n\t\tCASE WHEN COUNT(DISTINCT c.main_call_history_id) = 0 THEN 1 ELSE COUNT(DISTINCT c.main_call_history_id) END AS calls_answered_percent,\n\tCOUNT(DISTINCT c.main_call_history_id) - COUNT(DISTINCT CASE WHEN c.talking_duration > 0 THEN c.main_call_history_id END) AS calls_unanswered,\n\tSUM(c.talking_duration) AS talking_duration,\n\tSUM(c.talking_duration) / CASE WHEN COUNT(DISTINCT c.main_call_history_id) = 0 THEN 1 ELSE COUNT(DISTINCT c.main_call_history_id) END AS avg_talking_duration,\n\tSUM(c.duration) / CASE WHEN COUNT(DISTINCT c.main_call_history_id) = 0 THEN 1 ELSE COUNT(DISTINCT c.main_call_history_id) END AS avg_duration,\n\tSUM(c.duration) AS duration\nFROM outbound_connections AS c",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Calls Received",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls_answered": "",
                  "calls_received": "Calls received"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 3,
            "y": 43
          },
          "id": 7023,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Calls answered$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A"
            }
          ],
          "title": "Answered Calls",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls_answered": "Calls answered",
                  "calls_received": ""
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 6,
            "y": 43
          },
          "id": 7024,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^% answered$/",
              "values": false
            },
            "showPercentChange": false,
            "text": {
              "percentSize": 1
            },
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A"
            }
          ],
          "title": "% Calls Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls_answered": "",
                  "calls_answered_percent": "% answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 9,
            "y": 43
          },
          "id": 7025,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Calls not answered$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A"
            }
          ],
          "title": "Calls Not Answered",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls_unanswered": "Calls not answered"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 12,
            "y": 43
          },
          "id": 7026,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Average talking duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A"
            }
          ],
          "title": "Average Talking Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "avg_talking_duration": "Average talking duration",
                  "talking_duration": ""
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 15,
            "y": 43
          },
          "id": 7027,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Talking duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A"
            }
          ],
          "title": "Total Talking Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls_unanswered": "",
                  "talking_duration": "Talking duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 18,
            "y": 43
          },
          "id": 7028,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Average call duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A"
            }
          ],
          "title": "Average Call Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "avg_duration": "Average call duration",
                  "avg_talking_duration": ""
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 21,
            "y": 43
          },
          "id": 7029,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "/^Total call duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 4,
              "refId": "A"
            }
          ],
          "title": "Total Call Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "avg_duration": "",
                  "avg_talking_duration": "",
                  "duration": "Total call duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "smooth",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 12,
            "x": 0,
            "y": 47
          },
          "id": 7030,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-----------------------\n-- Outbound connections\n-----------------------\nWITH outbound_connections AS (\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\tc.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdroutput_path} AS c_orig ON\n\t\tc_orig.cdr_id = c.originating_cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND \n\t(\n\t\t(c.destination_entity_type = 'outbound_rule' AND c.destination_participant_is_incoming = FALSE AND c.termination_reason NOT IN ('cancelled', 'continued_in', 'rejected', 'src_participant_terminated', 'dst_participant_terminated'))\n\t\tOR\n\t\t(c.destination_entity_type = 'external_line' AND c.destination_participant_is_incoming = FALSE)\n\t)\n\tAND NOT (c.creation_forward_reason = 'polling' AND c.cdr_answered_at IS NULL AND c_orig.destination_entity_type IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue'))\t\t-- Exclude polling\n\t--AND c.cdr_answered_at IS NOT NULL\n\tGROUP BY c.main_call_history_id, participant_id\n\tUNION ALL\n\t---------\n\t-- Source\n\t---------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\tc.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.source_entity_type = 'external_line'\n\tAND c.source_participant_is_incoming = FALSE\n\t--AND c.cdr_answered_at IS NOT NULL\n\tGROUP BY c.main_call_history_id, participant_id\n)\nSELECT\n\tdate_trunc('hour', i.started_at) AS time_bucket,\n\tCOUNT(DISTINCT i.participant_id) AS calls\nFROM outbound_connections AS i\nGROUP BY time_bucket\nORDER BY time_bucket\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Inbound Calls over Time",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls": "Calls",
                  "time_bucket": "Time"
                }
              }
            }
          ],
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 9,
            "w": 12,
            "x": 12,
            "y": 47
          },
          "id": 7031,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-----------------------\n-- Outbound connections\n-----------------------\nWITH inbound_connections AS (\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\t--c.main_call_history_id,\n    c.source_participant_id AS extension_participant_id,\n\t\tmax(CASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND) AS extension\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdroutput_path} AS c_orig ON\n\t\tc_orig.cdr_id = c.originating_cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND \n\t(\n\t\t(c.destination_entity_type = 'outbound_rule' AND c.destination_participant_is_incoming = FALSE AND c.termination_reason NOT IN ('cancelled', 'continued_in', 'rejected', 'src_participant_terminated', 'dst_participant_terminated'))\n\t\tOR\n\t\t(c.destination_entity_type = 'external_line' AND c.destination_participant_is_incoming = FALSE)\n\t)\n\tAND NOT (c.creation_forward_reason = 'polling' AND c.cdr_answered_at IS NULL AND c_orig.destination_entity_type IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue'))\t\t-- Exclude polling\n\t--AND c.cdr_answered_at IS NOT NULL\n  GROUP BY extension_participant_id\n\tUNION ALL\n\t---------\n\t-- Source\n\t---------\n\tSELECT\n\t\t--c.main_call_history_id,\n    c.destination_participant_id AS extension_participant_id,\n\t\tmax(CASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND) AS extension\n\tFROM ${db_cdroutput_path} AS c\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.source_entity_type = 'external_line'\n\tAND c.source_participant_is_incoming = FALSE\n\t--AND c.cdr_answered_at IS NOT NULL\n\tGROUP BY extension_participant_id\n)\nSELECT\n\ti.extension,\n\tcount(DISTINCT i.extension_participant_id) AS calls\nFROM inbound_connections AS i\nGROUP BY extension\nORDER BY calls DESC\nLIMIT 10\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Top Called Extensions",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "calls": "Calls",
                  "extension": "Extension"
                }
              }
            }
          ],
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "fixed"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto",
                  "wrapText": false
                },
                "inspect": false
              },
              "mappings": [
                {
                  "options": {
                    "0": {
                      "color": "#3b3b3b",
                      "index": 0
                    },
                    "1": {
                      "color": "transparent",
                      "index": 1
                    }
                  },
                  "type": "value"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Call ID"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 320
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "talking_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "bill_cost"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "locale"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Gen Call ID"
                },
                "properties": [
                  {
                    "id": "custom.cellOptions",
                    "value": {
                      "applyToRow": true,
                      "mode": "basic",
                      "type": "color-background",
                      "wrapText": false
                    }
                  },
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "ringing_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 14,
            "w": 24,
            "x": 0,
            "y": 56
          },
          "id": 7032,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "enablePagination": true,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": false
            },
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Started at"
              }
            ]
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-----------------------\n-- Outbound connections\n-----------------------\nWITH outbound_connections AS (\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at AS answered_at,\n\t\tc.cdr_ended_at AS ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tEXTRACT(EPOCH FROM (coalesce(c.cdr_answered_at, c.cdr_ended_at) - c.cdr_started_at)) AS ringing_duration,\n\t\tCASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tLEFT JOIN ${db_cdroutput_path} AS c_orig ON\n\t\tc_orig.cdr_id = c.originating_cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND \n\t(\n\t\t(c.destination_entity_type = 'outbound_rule' AND c.destination_participant_is_incoming = FALSE AND c.termination_reason NOT IN ('cancelled', 'continued_in', 'rejected', 'src_participant_terminated', 'dst_participant_terminated'))\n\t\tOR\n\t\t(c.destination_entity_type = 'external_line' AND c.destination_participant_is_incoming = FALSE)\n\t)\n\tAND NOT (c.creation_forward_reason = 'polling' AND c.cdr_answered_at IS NULL AND c_orig.destination_entity_type IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue'))\t\t-- Exclude polling\n\t--AND c.cdr_answered_at IS NOT NULL\n\tUNION ALL\n\t--------------\n\t-- Source\n\t--------------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at AS answered_at,\n\t\tc.cdr_ended_at AS ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tEXTRACT(EPOCH FROM (coalesce(c.cdr_answered_at, c.cdr_ended_at) - c.cdr_started_at)) AS ringing_duration,\n\t\tcoalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0) AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.source_entity_type = 'external_line'\n\tAND c.source_participant_is_incoming = FALSE\n\t--AND c.cdr_answered_at IS NOT NULL\n),\nstat AS (\n\tSELECT\n\t\tROW_NUMBER() OVER(ORDER BY c.started_at DESC) AS id1,\n\t\tCASE WHEN (ROW_NUMBER() OVER(PARTITION BY c.main_call_history_id ORDER BY c.started_at DESC) - 1) > 0 THEN 1 ELSE 0 END AS id2,\n\t\t*\n\tFROM outbound_connections AS c\n)\nSELECT\n\t(c.id1 - SUM(c.id2) OVER(ORDER BY c.started_at DESC)) % 2 AS gen_call_id,\n\t-- c.main_call_history_id,\n\tc.source_participant,\n\tc.destination_participant,\n\tc.started_at,\n\tc.answered_at,\n\tc.ended_at,\n\tc.duration,\n\tc.ringing_duration,\n\tc.talking_duration,\n\tc.bill_cost\nFROM stat AS c\nORDER BY c.started_at DESC;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Outbound Calls",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "answered_at": "Answered at",
                  "bill_cost": "Bill cost",
                  "cdr_answered_at": "Answered at",
                  "cdr_ended_at": "Ended at",
                  "destination_participant": "External participant",
                  "did": "DID",
                  "duration": "Duration",
                  "ended_at": "Ended at",
                  "gen_call_id": "Gen Call ID",
                  "main_call_history_id": "Call ID",
                  "ringing_duration": "Ringing duration",
                  "source_participant": "Extension",
                  "started_at": "Started at",
                  "talking_duration": "Talking duration"
                }
              }
            },
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "Gen Call ID",
                    "Call ID",
                    "External participant",
                    "Extension",
                    "Started at",
                    "Answered at",
                    "Ended at",
                    "Ringing duration",
                    "Talking duration",
                    "Bill cost",
                    "DID"
                  ]
                }
              }
            }
          ],
          "type": "table"
        }
      ]
    },
    {
      "type": "row",
      "title": "Inbound vs Outbound Traffic",
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 42
      },
      "id": 10007,
      "panels": [
        {
          "gridPos": {
            "h": 2,
            "w": 24,
            "x": 0,
            "y": 43
          },
          "id": 8022,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# Inbound vs Outbound Call Traffic Analysis",
            "mode": "markdown"
          },
          "pluginVersion": "12.1.0-89438",
          "type": "text"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 0,
            "y": 45
          },
          "id": 8023,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^Total calls$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-------------------------------\n-- Inbound answered connections\n-------------------------------\nWITH inbound_connections AS (\n\t---------\n\t-- Source\n\t---------\n\tSELECT\n\t\tc.source_participant_id AS participant_id,\n    min(c.cdr_started_at) AS started_at,\n\t\tsum(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.source_entity_type = 'external_line'\n\tAND c.source_participant_is_incoming\n\tAND c.cdr_answered_at IS NOT NULL\n\tGROUP BY c.source_participant_id\n\tUNION ALL\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\tc.destination_participant_id AS participant_id,\n    min(c.cdr_started_at) AS started_at,\n\t\tsum(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.destination_entity_type = 'external_line'\n\tAND c.destination_participant_is_incoming\n\tAND c.cdr_answered_at IS NOT NULL\n\tGROUP BY participant_id\n),\n--------------------------------\n-- Outbound answered connections\n--------------------------------\noutbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(\n      round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS INTERVAL)) / 60, 0.00), 2)\n    ) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(\n      round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS INTERVAL)) / 60, 0.00), 2)\n    ) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Inbound statistics\ninbound_stat AS (\n\tSELECT\n\t\t0 AS direction_id,\n\t\t'in' AS direction,\n\t\tdate_trunc('hour', i.started_at) AS time_bucket,\n\t\tcount(DISTINCT i.participant_id) AS connections_count,\n\t\tsum(i.duration) AS duration,\n\t\tsum(i.talking_duration) AS talking_duration,\n\t\tsum(i.bill_cost) AS bill_cost\n\tFROM inbound_connections AS i\n\tGROUP BY time_bucket\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n\t\t1 AS direction_id,\n\t\t'out' AS direction,\n\t\tdate_trunc('hour', o.started_at) AS time_bucket,\n\t\tcount(DISTINCT o.participant_id) AS connections_count,\n\t\tsum(o.duration) AS duration,\n\t\tsum(o.talking_duration) AS talking_duration,\n\t\tsum(o.bill_cost) AS bill_cost\n\tFROM outbound_connections AS o\n\tGROUP BY time_bucket\n)\nSELECT\n\tcoalesce(i.time_bucket, o.time_bucket) AS time_bucket,\n\tcoalesce(i.connections_count, 0) + coalesce(o.connections_count, 0) AS connections_count,\n\tcoalesce(i.connections_count, 0) AS inbound_connections_count,\n\tcoalesce(i.duration, 0) AS inbound_duration,\n\tcoalesce(i.talking_duration, 0) AS inbound_talking_duration,\n\tcoalesce(i.bill_cost, 0.00) AS inbound_bill_cost,\n\tcoalesce(o.connections_count, 0) AS outbound_connections_count,\n\tcoalesce(o.duration, 0) AS outbound_duration,\n\tcoalesce(o.talking_duration, 0) AS outbound_talking_duration,\n\tcoalesce(o.bill_cost, 0.00) AS outbound_bill_cost\nFROM inbound_stat AS i\nFULL JOIN outbound_stat AS o ON\n\to.time_bucket = i.time_bucket\nORDER BY coalesce(i.time_bucket, o.time_bucket)\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Total Calls",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "connections_count": "Total calls",
                  "time_bucket": ""
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 3,
            "y": 45
          },
          "id": 8024,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^Inbound calls$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 2,
              "refId": "A"
            }
          ],
          "title": "Inbound Calls",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "inbound_connections_count": "Inbound calls"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 6,
            "y": 45
          },
          "id": 8025,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^Inbound duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 2,
              "refId": "A"
            }
          ],
          "title": "Inbound Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "inbound_duration": "Inbound duration",
                  "inbound_talking_duration": ""
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "green",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 9,
            "y": 45
          },
          "id": 8026,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^Inbound talking duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 2,
              "refId": "A"
            }
          ],
          "title": "Inbound Talking Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "inbound_duration": "",
                  "inbound_talking_duration": "Inbound talking duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "orange",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 12,
            "y": 45
          },
          "id": 8027,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^Outbound calls$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 2,
              "refId": "A"
            }
          ],
          "title": "Outbound Calls",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "inbound_bill_cost": "",
                  "outbound_connections_count": "Outbound calls"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "orange",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 15,
            "y": 45
          },
          "id": 8028,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^Outbound duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 2,
              "refId": "A"
            }
          ],
          "title": "Outbound Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "outbound_connections_count": "",
                  "outbound_duration": "Outbound duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "orange",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 18,
            "y": 45
          },
          "id": 8029,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^Outbound talking duration$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 2,
              "refId": "A"
            }
          ],
          "title": "Outbound Talking Duration",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "outbound_duration": "",
                  "outbound_talking_duration": "Outbound talking duration"
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "orange",
                "mode": "fixed"
              },
              "mappings": [],
              "noValue": "0",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "locale"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 21,
            "y": 45
          },
          "id": 8030,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "sum"
              ],
              "fields": "/^Outbound cost$/",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 2,
              "refId": "A"
            }
          ],
          "title": "Outbound Cost",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "outbound_bill_cost": "Outbound cost",
                  "outbound_talking_duration": ""
                }
              }
            }
          ],
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "fixed"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "fieldMinMax": false,
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "inbound_connections_count"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "green",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "outbound_connections_count"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "orange",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "connections_count"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Total calls"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 7,
            "w": 6,
            "x": 0,
            "y": 49
          },
          "id": 8031,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xField": "connections_count",
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 2,
              "refId": "A"
            }
          ],
          "title": "Calls by Direction",
          "transformations": [
            {
              "id": "filterFieldsByName",
              "options": {
                "byVariable": false,
                "include": {
                  "names": [
                    "connections_count",
                    "inbound_connections_count",
                    "outbound_connections_count",
                    "time_bucket"
                  ]
                }
              }
            },
            {
              "id": "reduce",
              "options": {
                "includeTimeField": false,
                "mode": "reduceFields",
                "reducers": [
                  "sum"
                ]
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "connections_count": "Total calls",
                  "inbound_connections_count": "Inbound calls",
                  "outbound_connections_count": "Outbound calls"
                }
              }
            }
          ],
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                }
              },
              "mappings": [],
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 6,
            "x": 6,
            "y": 49
          },
          "id": 8032,
          "options": {
            "displayLabels": [
              "percent"
            ],
            "legend": {
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true,
              "values": []
            },
            "pieType": "donut",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-------------------------------\n-- Inbound answered connections\n-------------------------------\nWITH inbound_connections AS (\n\t---------\n\t-- Source\n\t---------\n\tSELECT\n\t\tc.source_participant_id AS participant_id,\n    min(c.cdr_started_at) AS started_at,\n\t\tsum(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.source_entity_type = 'external_line'\n\tAND c.source_participant_is_incoming\n\tAND c.cdr_answered_at IS NOT NULL\n\tGROUP BY c.source_participant_id\n\tUNION ALL\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\tc.destination_participant_id AS participant_id,\n    min(c.cdr_started_at) AS started_at,\n\t\tsum(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.destination_entity_type = 'external_line'\n\tAND c.destination_participant_is_incoming\n\tAND c.cdr_answered_at IS NOT NULL\n\tGROUP BY participant_id\n),\ninbound_stat AS (\n\tSELECT\n\t\t0 AS direction_id,\n\t\t'in' AS direction,\n\t\tmin(i.started_at) AS started_at,\n\t\tsum(i.duration) AS duration,\n\t\tsum(i.talking_duration) AS talking_duration,\n\t\tsum(i.bill_cost) AS bill_cost\n\tFROM inbound_connections AS i\n\tGROUP BY i.participant_id\n),\ninbound_counts AS (\n\tSELECT\n\t\tcount(*) AS total_calls,\n\t\tcount(CASE WHEN i.duration < 60 THEN 1 END) AS less_than_1min,\n\t\tcount(CASE WHEN i.duration BETWEEN 60 AND 180 THEN 1 END) AS between_1min_and_3mins,\n\t\tcount(CASE WHEN i.duration > 180 THEN 1 END) AS more_than_3mins\n\tFROM inbound_stat AS i\n)\nSELECT\n\t*,\n\t100.00 / (CASE WHEN i.total_calls IS NULL OR i.total_calls = 0 THEN 1 ELSE i.total_calls END) * coalesce(i.less_than_1min, 0) AS less_than_1min_perc,\n\t100.00 / (CASE WHEN i.total_calls IS NULL OR i.total_calls = 0 THEN 1 ELSE i.total_calls END) * coalesce(i.between_1min_and_3mins, 0) AS between_1min_and_3mins_perc,\n\t100.00 / (CASE WHEN i.total_calls IS NULL OR i.total_calls = 0 THEN 1 ELSE i.total_calls END) * coalesce(i.more_than_3mins, 0) AS more_than_3mins_perc\nFROM inbound_counts AS i\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Inbound Call Duration",
          "transformations": [
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "less_than_1min_perc",
                    "between_1min_and_3mins_perc",
                    "more_than_3mins_perc"
                  ]
                }
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "between_1min_and_3mins_perc": "1 - 3 min",
                  "less_than_1min_perc": "< 1 min",
                  "more_than_3mins_perc": "> 3 min"
                }
              }
            }
          ],
          "type": "piechart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                }
              },
              "mappings": [],
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 6,
            "x": 12,
            "y": 49
          },
          "id": 8033,
          "options": {
            "displayLabels": [
              "percent"
            ],
            "legend": {
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true,
              "values": []
            },
            "pieType": "donut",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n    sum(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(\n      round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS INTERVAL)) / 60, 0.00), 2)\n    ) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n    sum(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(\n      round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS INTERVAL)) / 60, 0.00), 2)\n    ) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\noutbound_stat AS (\n\tSELECT\n\t\t1 AS direction_id,\n\t\t'out' AS direction,\n\t\tmin(o.started_at) AS started_at,\n\t\tsum(o.duration) AS duration,\n\t\tsum(o.talking_duration) AS talking_duration,\n\t\tsum(o.bill_cost) AS bill_cost\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n),\noutbound_counts AS (\n\tSELECT\n\t\tcount(*) AS total_calls,\n\t\tcount(CASE WHEN o.duration < 60 THEN 1 END) AS less_than_1min,\n\t\tcount(CASE WHEN o.duration BETWEEN 60 AND 180 THEN 1 END) AS between_1min_and_3mins,\n\t\tcount(CASE WHEN o.duration > 180 THEN 1 END) AS more_than_3mins,\n\t\tsum(CASE WHEN o.bill_cost < 1.00 THEN 1 END) AS cost_less_than_1,\n\t\tsum(CASE WHEN o.bill_cost BETWEEN 1.00 AND 2.00 THEN 1 END) AS cost_between_1_and_2,\n\t\tsum(CASE WHEN o.bill_cost > 2.00 THEN 1 END) AS cost_more_than_2\n\tFROM outbound_stat AS o\n)\nSELECT\n\t*,\n\t100.00 / (CASE WHEN o.total_calls IS NULL OR o.total_calls = 0 THEN 1 ELSE o.total_calls END) * coalesce(o.less_than_1min, 0) AS less_than_1min_perc,\n\t100.00 / (CASE WHEN o.total_calls IS NULL OR o.total_calls = 0 THEN 1 ELSE o.total_calls END) * coalesce(o.between_1min_and_3mins, 0) AS between_1min_and_3mins_perc,\n\t100.00 / (CASE WHEN o.total_calls IS NULL OR o.total_calls = 0 THEN 1 ELSE o.total_calls END) * coalesce(o.more_than_3mins, 0) AS more_than_3mins_perc,\n\t100.00 / (CASE WHEN o.total_calls IS NULL OR o.total_calls = 0 THEN 1 ELSE o.total_calls END) * coalesce(o.cost_less_than_1, 0) AS cost_less_than_1_perc,\n\t100.00 / (CASE WHEN o.total_calls IS NULL OR o.total_calls = 0 THEN 1 ELSE o.total_calls END) * coalesce(o.cost_between_1_and_2, 0) AS cost_between_1_and_2_perc,\n\t100.00 / (CASE WHEN o.total_calls IS NULL OR o.total_calls = 0 THEN 1 ELSE o.total_calls END) * coalesce(o.cost_more_than_2, 0) AS cost_more_than_2_perc\nFROM outbound_counts AS o\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Outbound Call Duration",
          "transformations": [
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "less_than_1min_perc",
                    "between_1min_and_3mins_perc",
                    "more_than_3mins_perc"
                  ]
                }
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "between_1min_and_3mins_perc": "1 - 3 min",
                  "less_than_1min_perc": "< 1 min",
                  "more_than_3mins_perc": "> 3 min"
                }
              }
            }
          ],
          "type": "piechart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                }
              },
              "mappings": [],
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 6,
            "x": 18,
            "y": 49
          },
          "id": 8034,
          "options": {
            "displayLabels": [
              "percent"
            ],
            "legend": {
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true,
              "values": []
            },
            "pieType": "donut",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 13,
              "refId": "A"
            }
          ],
          "title": "Outbound Call Cost",
          "transformations": [
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "cost_less_than_1_perc",
                    "cost_between_1_and_2_perc",
                    "cost_more_than_2_perc"
                  ]
                }
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "between_1min_and_3mins_perc": "1 - 3 min",
                  "cost_between_1_and_2_perc": "1.00 - 2.00",
                  "cost_less_than_1_perc": "< 1.00",
                  "cost_more_than_2_perc": "> 2.00",
                  "less_than_1min_perc": "< 1 min",
                  "more_than_3mins_perc": "> 3 min"
                }
              }
            }
          ],
          "type": "piechart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "",
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "fixed"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "smooth",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "fieldMinMax": false,
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "inbound_connections_count"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "green",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "outbound_connections_count"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "orange",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "connections_count"
                },
                "properties": [
                  {
                    "id": "displayName",
                    "value": "Total calls"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 7,
            "w": 24,
            "x": 0,
            "y": 56
          },
          "id": 8035,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "panelId": 2,
              "refId": "A"
            }
          ],
          "title": "Call Traffic over Time",
          "transformations": [
            {
              "id": "filterFieldsByName",
              "options": {
                "byVariable": false,
                "include": {
                  "names": [
                    "time_bucket",
                    "inbound_connections_count",
                    "outbound_connections_count"
                  ]
                }
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "inbound_connections_count": "Inblound calls",
                  "outbound_connections_count": "Outbound calls",
                  "time_bucket": ""
                }
              }
            }
          ],
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Call ID"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 320
                  },
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "talking_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "bill_cost"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "locale"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 9,
            "w": 24,
            "x": 0,
            "y": 63
          },
          "id": 8036,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "enablePagination": true,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": false
            },
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Started at"
              }
            ]
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-------------------------------\n-- Inbound answered connections\n-------------------------------\nWITH inbound_connections AS (\n\t---------\n\t-- Source\n\t---------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at,\n\t\tc.cdr_ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tCASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.source_entity_type = 'external_line'\n\tAND c.source_participant_is_incoming\n\tAND c.cdr_answered_at IS NOT NULL\n\tUNION ALL\n\t--------------\n\t-- Destination\n\t--------------\n\tSELECT\n\t\tc.main_call_history_id,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at,\n\t\tc.cdr_ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tcoalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0) AS talking_duration,\n\t\t0.00 AS bill_cost\n\tFROM ${db_cdroutput_path} AS c\n\tLEFT JOIN ${db_cdrbilling_path} AS b ON\n\t\tb.cdr_id = c.cdr_id\n\tWHERE $__timeFilter(c.cdr_started_at)\n\tAND c.destination_entity_type = 'external_line'\n\tAND c.destination_participant_is_incoming\n\tAND c.cdr_answered_at IS NOT NULL\n)\nSELECT *\nFROM inbound_connections AS c\nORDER BY c.started_at DESC\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Inbound Calls",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {
                  "bill_cost": 8,
                  "cdr_answered_at": 4,
                  "cdr_ended_at": 5,
                  "destination_participant": 3,
                  "duration": 6,
                  "main_call_history_id": 1,
                  "source_participant": 2,
                  "started_at": 0,
                  "talking_duration": 7
                },
                "renameByName": {
                  "bill_cost": "Bill cost",
                  "cdr_answered_at": "Answered at",
                  "cdr_ended_at": "Ended at",
                  "destination_participant": "Local participant",
                  "duration": "Duration",
                  "main_call_history_id": "Call ID",
                  "source_participant": "External participant",
                  "started_at": "Started at",
                  "talking_duration": "Talking duration"
                }
              }
            }
          ],
          "type": "table"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Call ID"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 320
                  },
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "talking_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "bill_cost"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "locale"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 9,
            "w": 24,
            "x": 0,
            "y": 72
          },
          "id": 8037,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "enablePagination": true,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": false
            },
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Started at"
              }
            ]
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n\t\tc.main_call_history_id,\n    --\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n\t\t--\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at,\n\t\tc.cdr_ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tcoalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0) AS talking_duration,\n    round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS INTERVAL)) / 60, 0.00), 2) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n\t\tc.main_call_history_id,\n    --\n\t\tCASE\n\t\t\tWHEN c.destination_entity_type = 'external_line'\n\t\t\t\tTHEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\t\tELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n\t\tEND AS source_participant,\n    --\n\t\tCASE\n\t\t\tWHEN c.source_entity_type = 'external_line'\n\t\t\t\tTHEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\t\tELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n\t\tEND AS destination_participant,\n\t\t--\n    c.cdr_started_at AS started_at,\n\t\tc.cdr_answered_at,\n\t\tc.cdr_ended_at,\n\t\tEXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_started_at)) AS duration,\n\t\tcoalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0) AS talking_duration,\n\t\tround(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS INTERVAL)) / 60, 0.00), 2) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n)\nSELECT *\nFROM outbound_connections AS c\nORDER BY c.started_at DESC\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Outbound Calls",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {
                  "bill_cost": 8,
                  "cdr_answered_at": 4,
                  "cdr_ended_at": 5,
                  "destination_participant": 3,
                  "duration": 6,
                  "main_call_history_id": 1,
                  "source_participant": 2,
                  "started_at": 0,
                  "talking_duration": 7
                },
                "renameByName": {
                  "bill_cost": "Bill cost",
                  "cdr_answered_at": "Answered at",
                  "cdr_ended_at": "Ended at",
                  "destination_participant": "External participant",
                  "duration": "Duration",
                  "main_call_history_id": "Call ID",
                  "source_participant": "Local participant",
                  "started_at": "Started at",
                  "talking_duration": "Talking duration"
                }
              }
            }
          ],
          "type": "table"
        }
      ]
    },
    {
      "type": "row",
      "title": "High Value Calls",
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 44
      },
      "id": 10008,
      "panels": [
        {
          "gridPos": {
            "h": 2,
            "w": 24,
            "x": 0,
            "y": 45
          },
          "id": 9023,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# High value calls, consumers and extensions",
            "mode": "markdown"
          },
          "pluginVersion": "12.1.0-89438",
          "type": "text"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "description": "High value calls ratio",
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "blue",
                "mode": "fixed"
              },
              "fieldMinMax": false,
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "high_value_connections"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "red",
                      "mode": "fixed"
                    }
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "no_value_connections"
                },
                "properties": [
                  {
                    "id": "color",
                    "value": {
                      "fixedColor": "green",
                      "mode": "fixed"
                    }
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 8,
            "w": 5,
            "x": 0,
            "y": 47
          },
          "id": 9024,
          "options": {
            "displayMode": "gradient",
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "maxVizHeight": 300,
            "minVizHeight": 16,
            "minVizWidth": 8,
            "namePlacement": "auto",
            "orientation": "vertical",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showUnfilled": true,
            "sizing": "auto",
            "valueMode": "color"
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n\t\tsum(o.bill_cost) AS bill_cost\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n)\nSELECT\n  'high value calls ratio' AS text,\n  count(*) AS total_connections,\n  count(CASE WHEN o.bill_cost >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN 1 END) AS high_value_connections,\n  count(CASE WHEN o.bill_cost < CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN 1 END) AS no_value_connections\nFROM outbound_stat AS o\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Call Value",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "high_value_connections": "High value calls",
                  "no_value_connections": "No value calls",
                  "total_connections": "Total outbound calls"
                }
              }
            }
          ],
          "type": "bargauge"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "continuous-YlRd"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "yellow",
                    "value": 10
                  },
                  {
                    "color": "red",
                    "value": 50
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 3,
            "x": 5,
            "y": 47
          },
          "id": 9025,
          "options": {
            "minVizHeight": 75,
            "minVizWidth": 75,
            "orientation": "auto",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showThresholdLabels": false,
            "showThresholdMarkers": true,
            "sizing": "auto"
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n\t\tsum(o.bill_cost) AS bill_cost\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n)\nSELECT\n  -- High value connections\n  coalesce(count(CASE WHEN o.bill_cost >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN 1 END), 0)\n  * 100.0\n  -- All connections\n  / CASE WHEN count(*) = 0 THEN 1 ELSE count(*) END\nFROM outbound_stat AS o\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "% High Value Calls Ratio",
          "type": "gauge"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 8,
            "y": 47
          },
          "id": 9026,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n\t\tsum(o.bill_cost) AS bill_cost,\n    sum(o.talking_duration) AS talking_duration\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n)\nSELECT\n  avg(CASE WHEN o.bill_cost >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN o.talking_duration END) AS high_value_avg_duration\nFROM outbound_stat AS o\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Average Talking Duration",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 11,
            "y": 47
          },
          "id": 9027,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n\t\tsum(o.bill_cost) AS bill_cost,\n    sum(o.talking_duration) AS talking_duration\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n)\nSELECT\n  sum(CASE WHEN o.bill_cost >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN o.talking_duration END) AS high_value_total_duration\nFROM outbound_stat AS o\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Total Talking Duration",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 5,
            "x": 14,
            "y": 47
          },
          "id": 9028,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n    sum(o.duration) AS duration,\n\t\tsum(o.bill_cost) AS bill_cost\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n  HAVING sum(o.bill_cost) >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric)\n)\nSELECT\n  0 AS row_order,\n  '< 5 min' AS duration_type,\n  count(CASE WHEN o.duration < 300 THEN 1 END) AS connections\nFROM outbound_stat AS o\nUNION ALL\nSELECT\n  1 AS row_order,\n  '5-10 min' AS duration_type,\n  count(CASE WHEN o.duration BETWEEN 300 AND 599 THEN 1 END) AS connections\nFROM outbound_stat AS o\nUNION ALL\nSELECT\n  2 AS row_order,\n  '10-15 min' AS duration_type,\n  count(CASE WHEN o.duration BETWEEN 600 AND 899 THEN 1 END) AS connections\nFROM outbound_stat AS o\nUNION ALL\nSELECT\n  3 AS row_order,\n  '15-20 min' AS duration_type,\n  count(CASE WHEN o.duration BETWEEN 900 AND 1199 THEN 1 END) AS connections\nFROM outbound_stat AS o\nUNION ALL\nSELECT\n  4 AS row_order,\n  '20+ min' AS duration_type,\n  count(CASE WHEN o.duration >= 1200 THEN 1 END) AS connections\nFROM outbound_stat AS o\nORDER BY row_order\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "High Value Call Duration",
          "transformations": [
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "duration_type",
                    "connections"
                  ]
                }
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "connections": "High value calls",
                  "duration_type": "Duration"
                }
              }
            }
          ],
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 5,
            "x": 19,
            "y": 47
          },
          "id": 9029,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n    sum(o.duration) AS duration,\n\t\tsum(o.bill_cost) AS bill_cost\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n  HAVING sum(o.bill_cost) >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric)\n)\nSELECT\n  0 AS row_order,\n  '< 1.00' AS cost_type,\n  count(CASE WHEN o.bill_cost < 1.00 THEN 1 END) AS connections\nFROM outbound_stat AS o\nUNION ALL\nSELECT\n  1 AS row_order,\n  '1.00 - 5.00' AS cost_type,\n  count(CASE WHEN o.bill_cost >= 1.00 AND o.bill_cost < 5.00 THEN 1 END) AS connections\nFROM outbound_stat AS o\nUNION ALL\nSELECT\n  2 AS row_order,\n  '5.00 - 10.00' AS cost_type,\n  count(CASE WHEN o.bill_cost >= 5.00 AND o.bill_cost < 10.00 THEN 1 END) AS connections\nFROM outbound_stat AS o\nUNION ALL\nSELECT\n  3 AS row_order,\n  '>= 10.00' AS cost_type,\n  count(CASE WHEN o.bill_cost >= 10.00 THEN 1 END) AS connections\nFROM outbound_stat AS o\nORDER BY row_order\n;\n",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "High Value Call Cost Distribution",
          "transformations": [
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "cost_type",
                    "connections"
                  ]
                }
              }
            },
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "connections": "High value calls",
                  "cost_type": "Bill cost"
                }
              }
            }
          ],
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "locale"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 8,
            "y": 51
          },
          "id": 9030,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n\t\tsum(o.bill_cost) AS bill_cost,\n    sum(o.talking_duration) AS talking_duration\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n)\nSELECT\n  round(avg(CASE WHEN o.bill_cost >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN o.bill_cost END), 2) AS high_value_avg_bill_cost\nFROM outbound_stat AS o\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Average Bill Cost",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "fixedColor": "red",
                "mode": "fixed"
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "blue",
                    "value": 0
                  }
                ]
              },
              "unit": "locale"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 3,
            "x": 11,
            "y": 51
          },
          "id": 9031,
          "options": {
            "colorMode": "value",
            "graphMode": "area",
            "justifyMode": "auto",
            "orientation": "auto",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n\t\tsum(o.bill_cost) AS bill_cost,\n    sum(o.talking_duration) AS talking_duration\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n)\nSELECT\n  sum(CASE WHEN o.bill_cost >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN o.bill_cost END) AS high_value_total_bill_cost\nFROM outbound_stat AS o\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Total Bill Cost",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 55
          },
          "id": 9032,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "text": {},
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n    max(c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')) AS consumer,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n    max(c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')) AS consumer,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at) AND \n  c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n    max(o.consumer) AS consumer,\n\t\t--sum(o.duration) AS duration,\n\t\t--sum(o.talking_duration) AS talking_duration,\n\t\tsum(o.bill_cost) AS bill_cost\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n)\nSELECT\n  o.consumer,\n  count(CASE WHEN o.bill_cost >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN 1 END) AS high_value_connections\nFROM outbound_stat AS o\nGROUP BY o.consumer\nHAVING count(CASE WHEN o.bill_cost >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN 1 END) > 0\nORDER BY high_value_connections DESC\nLIMIT 10\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "High Value Consumers",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "consumer": "Cinsumer",
                  "high_value_connections": "High value calls"
                }
              }
            }
          ],
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "fillOpacity": 80,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "lineWidth": 1,
                "scaleDistribution": {
                  "type": "linear"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "red",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 55
          },
          "id": 9033,
          "options": {
            "barRadius": 0,
            "barWidth": 0.97,
            "fullHighlight": false,
            "groupWidth": 0.7,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false
            },
            "orientation": "auto",
            "showValue": "auto",
            "stacking": "none",
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            },
            "xTickLabelRotation": 0,
            "xTickLabelSpacing": 0
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n    c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown') AS extension,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  AND c.source_entity_type = 'extension'\n  GROUP BY c.destination_participant_id, extension\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n    c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown') AS extension,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  AND c.destination_entity_type = 'extension'\n  GROUP BY c.source_participant_id, extension\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n    o.extension AS extension,\n\t\tsum(o.bill_cost) AS bill_cost\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id, o.extension\n)\nSELECT\n  o.extension,\n  count(CASE WHEN o.bill_cost >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN 1 END) AS high_value_connections\nFROM outbound_stat AS o\nGROUP BY o.extension\nHAVING count(CASE WHEN o.bill_cost >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric) THEN 1 END) > 0\nORDER BY high_value_connections DESC\nLIMIT 10\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Top Extensions by Cost",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "extension": "Extension",
                  "high_value_connections": "High value calls"
                }
              }
            }
          ],
          "type": "barchart"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "bill_cost"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "locale"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "talking_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 11,
            "w": 9,
            "x": 0,
            "y": 63
          },
          "id": 9034,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": true
            },
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Bill cost"
              }
            ]
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "--------------------------------\n-- Outbound answered connections\n--------------------------------\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n    max(c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')) AS consumer,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.destination_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n    max(c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')) AS consumer,\n\t\tmin(c.cdr_started_at) AS started_at,\n\t\tEXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n\t\tsum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM CAST(b.source_bill_duration AS interval)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n\t$__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n\tSELECT\n    o.participant_id,\n    max(o.consumer) AS consumer,\n\t\tsum(o.talking_duration) AS talking_duration,\n\t\tsum(o.bill_cost) AS bill_cost\n\tFROM outbound_connections AS o\n\tGROUP BY o.participant_id\n  HAVING sum(o.bill_cost) >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric)\n)\nSELECT\n  o.consumer,\n  count(*) AS connections,\n  sum(o.talking_duration) AS talking_duration,\n  sum(o.bill_cost) AS bill_cost\nFROM outbound_stat AS o\nGROUP BY o.consumer\nORDER BY sum(o.bill_cost) DESC\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Top Consumers by Bill Cost",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "bill_cost": "Bill cost",
                  "connections": "High value calls",
                  "consumer": "Consumer",
                  "talking_duration": "Talking duration"
                }
              }
            }
          ],
          "type": "table"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto"
                },
                "inspect": false
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "talking_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "bill_cost"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "locale"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Extension"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 255
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Answered at"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 192
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 11,
            "w": 15,
            "x": 9,
            "y": 63
          },
          "id": 9035,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": true
            },
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Answered at"
              }
            ]
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-- Outbound answered connections\nWITH outbound_connections AS (\n  --------------\n  -- Destination\n  --------------\n  SELECT\n    c.destination_participant_id AS participant_id,\n    max(c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')) AS consumer,\n    min(c.cdr_started_at) AS started_at,\n    EXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n    sum(coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0)) AS talking_duration,\n    sum(round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM (b.destination_bill_duration)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n  $__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'external_line'\n  AND c.destination_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.destination_participant_id\n  UNION ALL\n  ---------\n  -- Source\n  ---------\n  SELECT\n    c.source_participant_id AS participant_id,\n    max(c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')) AS consumer,\n    min(c.cdr_started_at) AS started_at,\n    EXTRACT(EPOCH FROM (max(c.cdr_ended_at) - min(c.cdr_started_at))) AS duration,\n    sum(CASE WHEN c.destination_entity_type NOT IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue') THEN EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)) ELSE 0 END) AS talking_duration,\n    sum(round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM (b.source_bill_duration)) / 60, 0.00), 2)) AS bill_cost\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdrbilling_path} AS b ON\n    b.cdr_id = c.cdr_id\n  WHERE\n  $__timeFilter(c.cdr_started_at)\n  AND c.source_entity_type = 'external_line'\n  AND c.source_participant_is_incoming = FALSE\n  AND c.cdr_answered_at IS NOT NULL\n  GROUP BY c.source_participant_id\n),\n-- Outbound statistics\noutbound_stat AS (\n  SELECT\n    o.participant_id\n  FROM outbound_connections AS o\n  GROUP BY o.participant_id\n  HAVING sum(o.bill_cost) >= CAST(NULLIF('${bill_cost_treshhold}', '') AS numeric)\n)\nSELECT\n  CASE\n    WHEN c.destination_entity_type = 'external_line'\n      THEN c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n    ELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n  END AS extension,\n  CASE\n    WHEN c.destination_entity_type = 'external_line'\n      THEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n    ELSE c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n  END AS consumer,\n  c.cdr_answered_at AS answered_at,\n  coalesce(EXTRACT(EPOCH FROM (c.cdr_ended_at - c.cdr_answered_at)), 0) AS talking_duration,\n  CASE\n    WHEN c.destination_entity_type = 'external_line'\n      THEN coalesce(b.destination_bill_code, 'Unknown')\n    ELSE coalesce(b.source_bill_code, 'Unknown')\n  END AS bill_code,\n  CASE\n    WHEN c.destination_entity_type = 'external_line'\n      THEN coalesce(b.destination_bill_rate_name, 'Unknown')\n    ELSE coalesce(b.source_bill_rate_name, 'Unknown')\n  END AS bill_rate_name,\n  CASE\n    WHEN c.destination_entity_type = 'external_line'\n      THEN coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) -- Changed 'Unknown' to 0.00\n    ELSE coalesce(CAST(b.source_bill_rate AS numeric), 0.00) -- Changed 'Unknown' to 0.00\n  END AS bill_rate,\n  round(coalesce(CAST(b.source_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM (b.source_bill_duration)) / 60, 0.00), 2)\n  +\n  round(coalesce(CAST(b.destination_bill_rate AS numeric), 0.00) * coalesce(EXTRACT(EPOCH FROM (b.destination_bill_duration)) / 60, 0.00), 2)\n  AS bill_cost\nFROM ${db_cdroutput_path} AS c\nINNER JOIN outbound_stat AS o ON\n  o.participant_id = c.source_participant_id\n  OR\n  o.participant_id = c.destination_participant_id\nLEFT JOIN ${db_cdrbilling_path} AS b ON\n  b.cdr_id = c.cdr_id\nWHERE\n$__timeFilter(c.cdr_started_at)\nAND\n  (\n    c.destination_entity_type = 'external_line' AND c.destination_participant_is_incoming = FALSE\n    OR\n    c.source_entity_type = 'external_line' AND c.source_participant_is_incoming = FALSE\n  )\nAND c.cdr_answered_at IS NOT NULL\nORDER BY answered_at DESC;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Top Calls by Cost",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {},
                "renameByName": {
                  "answered_at": "Answered at",
                  "bill_code": "Bill code",
                  "bill_cost": "Bill cost",
                  "bill_rate": "Bill rate",
                  "bill_rate_name": "Bill rate name",
                  "consumer": "Consumer",
                  "extension": "Extension",
                  "talking_duration": "Talking duration"
                }
              }
            }
          ],
          "type": "table"
        }
      ]
    },
    {
      "type": "row",
      "title": "Missed Calls & Redialed",
      "collapsed": true,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 46
      },
      "id": 10009,
      "panels": [
        {
          "gridPos": {
            "h": 2,
            "w": 24,
            "x": 0,
            "y": 47
          },
          "id": 10024,
          "options": {
            "code": {
              "language": "plaintext",
              "showLineNumbers": false,
              "showMiniMap": false
            },
            "content": "# Missed Calls & Redialed Callbacks",
            "mode": "markdown"
          },
          "pluginVersion": "12.1.0-89438",
          "type": "text"
        },
        {
          "datasource": {
            "type": "grafana-postgresql-datasource",
            "uid": "reditech-3cx-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "fixed"
              },
              "custom": {
                "align": "auto",
                "cellOptions": {
                  "type": "auto",
                  "wrapText": false
                },
                "inspect": false
              },
              "mappings": [
                {
                  "options": {
                    "0": {
                      "color": "#3b3b3b",
                      "index": 0
                    },
                    "1": {
                      "color": "transparent",
                      "index": 1
                    }
                  },
                  "type": "value"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  }
                ]
              }
            },
            "overrides": [
              {
                "matcher": {
                  "id": "byName",
                  "options": "Call ID"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 320
                  },
                  {
                    "id": "custom.hidden",
                    "value": true
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "ringing_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "xcb_talking_duration"
                },
                "properties": [
                  {
                    "id": "unit",
                    "value": "s"
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Callback status"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 176
                  }
                ]
              },
              {
                "matcher": {
                  "id": "byName",
                  "options": "Ringing duration"
                },
                "properties": [
                  {
                    "id": "custom.width",
                    "value": 201
                  }
                ]
              }
            ]
          },
          "gridPos": {
            "h": 28,
            "w": 24,
            "x": 0,
            "y": 49
          },
          "id": 10025,
          "options": {
            "cellHeight": "sm",
            "footer": {
              "countRows": false,
              "fields": "",
              "reducer": [
                "sum"
              ],
              "show": true
            },
            "showHeader": true,
            "sortBy": [
              {
                "desc": true,
                "displayName": "Started at"
              }
            ]
          },
          "pluginVersion": "12.1.0-89438",
          "targets": [
            {
              "dataset": "cdr",
              "datasource": {
                "type": "grafana-postgresql-datasource",
                "uid": "reditech-3cx-ds"
              },
              "editorMode": "code",
              "format": "table",
              "rawQuery": true,
              "rawSql": "-- Not answered CDRs\nWITH cdrs AS (\n  SELECT\n    c.cdr_id\n  FROM ${db_cdroutput_path} AS c\n  LEFT JOIN ${db_cdroutput_path} AS c_orig ON\n    c_orig.cdr_id = c.originating_cdr_id\n  WHERE $__timeFilter(c.cdr_started_at)\n  AND c.destination_entity_type = 'extension'\n  AND c.cdr_answered_at IS NULL\n  AND \n  (\n    c_orig.cdr_id IS NULL\n    OR NOT\n    (c.creation_forward_reason = 'polling' AND c_orig.destination_entity_type IN ('group', 'ring_group_ring_all', 'ring_group_hunt', 'queue'))\t\t-- Exclude polling\n  )\n  AND c.source_entity_type = 'external_line'\n),\n-- Intermediate step to rank callbacks\nranked_callbacks AS (\n  SELECT\n    c.main_call_history_id,\n    c.cdr_id AS original_cdr_id,\n    c.source_entity_type AS original_source_entity_type,\n    c.source_participant_phone_number AS original_source_participant_phone_number,\n    c.source_dn_name AS original_source_dn_name,\n    c.source_dn_number AS original_source_dn_number,\n    c.source_participant_trunk_did AS original_source_participant_trunk_did,\n    c.destination_entity_type AS original_destination_entity_type,\n    c.destination_participant_phone_number AS original_destination_participant_phone_number,\n    c.destination_dn_name AS original_destination_dn_name,\n    c.destination_dn_number AS original_destination_dn_number,\n    c.cdr_started_at AS original_started_at,\n    c.cdr_answered_at AS original_answered_at,\n    c.cdr_ended_at AS original_ended_at,\n    xcb.cdr_id AS xcb_cdr_id_val,\n    xcb.cdr_started_at AS xcb_started_at,\n    xcb.cdr_answered_at AS xcb_answered_at,\n    xcb.cdr_ended_at AS xcb_ended_at,\n    ROW_NUMBER() OVER (PARTITION BY xcb.destination_dn_number, xcb.destination_participant_phone_number ORDER BY xcb.cdr_id) as rn\n  FROM ${db_cdroutput_path} AS c\n  INNER JOIN cdrs ON\n    cdrs.cdr_id = c.cdr_id\n  INNER JOIN ${db_cdroutput_path} AS xcb ON\n    xcb.cdr_started_at > c.cdr_started_at\n    AND xcb.main_call_history_id != c.main_call_history_id\n    AND xcb.source_entity_type = c.destination_entity_type          -- Callback source is original call's destination\n    AND xcb.source_dn_number = c.destination_dn_number              -- Callback source DN is original call's destination DN\n    AND xcb.destination_entity_type = c.source_entity_type          -- Callback destination is original call's source\n    AND xcb.destination_participant_phone_number = c.source_participant_phone_number -- Callback destination phone is original call's source phone\n),\n-- Calls with explicit callbacks (filtered by rank)\ncalls_with_xcallbacks AS (\n  SELECT\n    rc.main_call_history_id,\n    rc.original_cdr_id AS cdr_id,\n    CASE\n      WHEN rc.original_source_entity_type = 'external_line'\n        THEN rc.original_source_participant_phone_number || ' ' || coalesce(rc.original_source_dn_name, 'Unknown')\n      ELSE rc.original_source_dn_number || ' ' || coalesce(rc.original_source_dn_name, 'Unknown')\n    END AS source_participant,\n    coalesce(rc.original_source_participant_trunk_did, 'Unknown') AS did,\n    CASE\n      WHEN rc.original_destination_entity_type = 'external_line'\n        THEN rc.original_destination_participant_phone_number || ' ' || coalesce(rc.original_destination_dn_name, 'Unknown')\n      ELSE rc.original_destination_dn_number || ' ' || coalesce(rc.original_destination_dn_name, 'Unknown')\n    END AS destination_participant,\n    rc.original_started_at AS started_at,\n    EXTRACT(EPOCH FROM (coalesce(rc.original_answered_at, rc.original_ended_at) - rc.original_started_at)) AS ringing_duration,\n    CASE\n      WHEN EXTRACT(EPOCH FROM (rc.xcb_started_at - rc.original_ended_at)) <= 86400\n        THEN '\u2705'\n      ELSE '\u274c'\n    END AS xcb_made,\n    rc.xcb_cdr_id_val AS xcb_cdr_id,\n    CASE WHEN rc.xcb_answered_at IS NOT NULL THEN 'Successful' ELSE 'Failed' END AS xcb_status,\n    CASE WHEN rc.xcb_answered_at IS NOT NULL THEN EXTRACT(EPOCH FROM (rc.xcb_ended_at - rc.xcb_started_at)) END AS xcb_talking_duration\n  FROM ranked_callbacks rc\n  WHERE rc.rn = 1\n)\nSELECT c.*\nFROM calls_with_xcallbacks AS c\nUNION ALL\nSELECT\n  c.main_call_history_id,\n  c.cdr_id,\n  CASE\n    WHEN c.source_entity_type = 'external_line'\n      THEN c.source_participant_phone_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n    ELSE c.source_dn_number || ' ' || coalesce(c.source_dn_name, 'Unknown')\n  END AS source_participant,\n  coalesce(c.source_participant_trunk_did, 'Unknown') AS did,\n  CASE\n    WHEN c.destination_entity_type = 'external_line'\n      THEN c.destination_participant_phone_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n    ELSE c.destination_dn_number || ' ' || coalesce(c.destination_dn_name, 'Unknown')\n  END AS destination_participant,\n  c.cdr_started_at AS started_at,\n  EXTRACT(EPOCH FROM (coalesce(c.cdr_answered_at, c.cdr_ended_at) - c.cdr_started_at)) AS ringing_duration,\n  '\u274c' AS xcb_made,\n  CAST(NULL AS uuid) AS xcb_cdr_id,\n  'No callbacks made' AS xcb_status,\n  CAST(NULL AS integer) AS xcb_talking_duration\nFROM ${db_cdroutput_path} AS c\nINNER JOIN cdrs ON\n  cdrs.cdr_id = c.cdr_id\nWHERE NOT EXISTS (\n  SELECT 1 FROM calls_with_xcallbacks AS x WHERE x.cdr_id = c.cdr_id\n)\nORDER BY started_at DESC\n;",
              "refId": "A",
              "sql": {
                "columns": [
                  {
                    "parameters": [],
                    "type": "function"
                  }
                ],
                "groupBy": [
                  {
                    "property": {
                      "type": "string"
                    },
                    "type": "groupBy"
                  }
                ],
                "limit": 50
              }
            }
          ],
          "title": "Missed calls",
          "transformations": [
            {
              "id": "organize",
              "options": {
                "excludeByName": {},
                "includeByName": {},
                "indexByName": {
                  "cdr_id": 2,
                  "destination_participant": 5,
                  "did": 4,
                  "main_call_history_id": 1,
                  "ringing_duration": 6,
                  "source_participant": 3,
                  "started_at": 0,
                  "xcb_cdr_id": 8,
                  "xcb_made": 7,
                  "xcb_status": 9,
                  "xcb_talking_duration": 10
                },
                "renameByName": {
                  "answered_at": "Answered at",
                  "bill_cost": "Bill cost",
                  "cdr_answered_at": "Answered at",
                  "cdr_ended_at": "Ended at",
                  "destination_participant": "Extension",
                  "did": "DID",
                  "duration": "Duration",
                  "ended_at": "Ended at",
                  "gen_call_id": "Gen Call ID",
                  "main_call_history_id": "Call ID",
                  "ringing_duration": "Ringing duration",
                  "source_participant": "External participant",
                  "started_at": "Started at",
                  "talking_duration": "Talking duration",
                  "xcb_made": "Callback made within 24 hours",
                  "xcb_status": "Callback status",
                  "xcb_talking_duration": "Callback talking duration"
                }
              }
            },
            {
              "id": "filterFieldsByName",
              "options": {
                "include": {
                  "names": [
                    "Call ID",
                    "External participant",
                    "DID",
                    "Extension",
                    "Started at",
                    "Ringing duration",
                    "Callback made within 24 hours",
                    "Callback status",
                    "Callback talking duration"
                  ]
                }
              }
            }
          ],
          "type": "table"
        }
      ]
    }
  ],
  "links": []
}